# RePlay
Библиотека RePlay содержит инструменты для создания рекомендательных систем от предобработки данных до выбора лучшего решения. 
В Replay используется Spark, чтобы эффективно работать с большими датасетами.

RePlay поможет:
* Фильтровать и разбить данные для обучения рекомендательной системы
* Обучить модель и получить рекомендации
* Подобрать гиперпараметры моделей
* Оценить качество по метрикам и сравнить модели

### Алгоритмы, реализованные в RePlay
**Характеристики алгоритмов**
* Тип алгоритма:
    - Collaborative, коллаборативная фильтрация. Используют историю взаимодействия пользователей и объектов для построения рекомендаций. 
    - Content-based. Используют признаковые описания пользователей и объектов для построения рекомендаций.
    - Hybrid, гибридные. Используют коллаборативную информацию, признаки пользователей/объектов, результаты работы других алгоритмов.
* Адаптирован ли алгоритм для неявных предпочтений (implicit feedback)? (Тип взаимодействия) 
* Являются ли рекомендации персонализированными?
* Можно ли получить рекомендации для пользователя, который не взаимодействовал с объектами? (Холодные пользователи)
* Может ли алгоритм рекомендовать объекты, для которых отсутствует история взаимодействия с пользователями? (Холодные объекты)
* Может ли алгоритм рекомендовать новые для пользователя объекты? Если наша задача - порекомендовать пользователю что-то, что он уже видел ранее, хороший бейзлайн - рекомендации самого популярного из истории. В этом случае алгоритм не сможет предсказать объекты, с которыми пользователь ранее не взаимодействовал.

| Алгоритм       | Тип          | Тип взаимодействия | Персонализированные | Холодные пользователи | Холодные объекты |  Новые объекты |
| ---------------|--------------|-------|-------|-------|-------|-------|
|Popular Recommender        |Collaborative    | explicit          | - | + | - | + |
|Wilson Recommender         |Collaborative    | explicit          | - | + | - | + |
|Random Recommender         |Collaborative    | explicit          | - | + | - | + |
|K-Nearest Neighbours       |Collaborative    | explicit          | + | + | - | + |
|Classifier Recommender     |Content-based    | explicit          | + | + | + | + |
|Alternating Least Squares  |Collaborative    | implicit          | + | - | - | + |
|Neural Matrix Factorization|Collaborative    | implicit          | + | - | - | + |
|SLIM                       |Collaborative    | implicit          | + | - | - | + |
|ADMM SLIM                  |Collaborative    | implicit          | + | - | - | + |
|Mult-VAE                   |Collaborative    | explicit          | + | - | - | + |
|Word2Vec Recommender       |Collaborative    | explicit          | + | - | - | + |
|Обертка LightFM            |Hybrid           | implicit          | + | + | + | + |
|Обертка Implicit           |Collaborative    | implicit          | + | - | - | + |

**Многоуровневые модели**

| Алгоритм       | Тип          | Тип взаимодействия | Персонализированные | Холодные пользователи | Холодные объекты |  Новые объекты |
| ---------------|--------------|-------|-------|-------|-------|-------|
|Stack Recommender          | `*`                | `*`                | + | `*` | `*` | `*` |
|Двухуровневый классификатор|Hybrid           | explicit          | + | + | + | + |
 
`*` - зависит от алгоритмов, используемых в качестве базовых.

Больше информации об алгоритмах - в документации к replay.

### Метрики
В библиотеке реализованы ключевые метрики для оценки качества рекомендательных систем, такие как **HitRate, Precision, MAP, Recall, ROC-AUC, MRR, NDCG, Surprisal, Unexpectedness, Coverage**.
Метрики можно посчитать для различных значений _k_ (числа рекомендаций для подсчета метрики), оценить среднее или медианное значение метрики по пользователям и нижнюю границу доверительного интервала.  

### Сценарии 
В библиотеке реализованы сценарии, объединяющие основные этапы создания рекомендательной системы:
* разбиение данных на обучающую и валидационную выборки
* автоматический подбор гиперпараметров моделей
* расчёт метрик и сравнение моделей
* обучение на всём объёме данных и отгрузка рекомендаций (batch production)

### Эксперименты
Класс эксперимент позволяет расчитать выбранные метрики для рекомендаций, полученных несколькими моделями, и сравнить их. 

### Дополнительные инструменты
В RePlay можно отфильтровать данные, разбить их на тренировочную и тестовую выборки несколькими способами и преобразовать в формат библиотеки, одинаковый для всех моделей.
Инструменты RePlay позволяют отфильтровать уже просмотренные пользователем объекты из списка рекомендаций, а также дополнить рекомендации до нужного количества в случае, если модель предсказала меньшее число рекомендуемых объектов.   

## Как начать пользоваться библиотекой

### Установка
Для корректной работы используйте python 3.6+ и java 8+. \
Сделайте клон репозитория и установите библиотеку:
```bash
git clone https://sbtatlas.sigma.sbrf.ru/stash/scm/ailab/replay.git
cd replay
pip install --upgrade pip
pip install poetry
poetry install
```

### Проверка работы библиотеки
Запустите тесты для проверки корректность установки. \
Из директории `replay`:
```bash
pytest ./tests
```

### Документация
Документацию можно сформировать самостоятельно после установки пакета.\
Из директории `replay`:
```bash
cd ./docs
mkdir -p _static
make clean html
```
Документация будет доступна в `replay/docs/_build/html/index.html`


### Начало работы
Примеры использования библиотеки в директории `experiments`.


## Как присоединиться к разработке
[Инструкция для разработчика](README_dev.md)
