<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Models &mdash; RePlay  documentation</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/sphinx_highlight.js"></script>
        <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Metrics" href="metrics.html" />
    <link rel="prev" title="Splitters" href="splitters.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            RePlay
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../development.html">Development</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../modules.html">Modules</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="data.html">Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="preprocessing.html">Preprocessing</a></li>
<li class="toctree-l2"><a class="reference internal" href="splitters.html">Splitters</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Models</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#replay-recommenders">RePlay Recommenders</a></li>
<li class="toctree-l3"><a class="reference internal" href="#recommender-interface">Recommender interface</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#replay.models.Recommender"><code class="docutils literal notranslate"><span class="pre">Recommender</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#distributed-models">Distributed models</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#popular-recommender">Popular Recommender</a></li>
<li class="toctree-l4"><a class="reference internal" href="#query-popular-recommender">Query Popular Recommender</a></li>
<li class="toctree-l4"><a class="reference internal" href="#wilson-recommender">Wilson Recommender</a></li>
<li class="toctree-l4"><a class="reference internal" href="#random-recommender">Random Recommender</a></li>
<li class="toctree-l4"><a class="reference internal" href="#ucb-recommender">UCB Recommender</a></li>
<li class="toctree-l4"><a class="reference internal" href="#kl-ucb-recommender">KL-UCB Recommender</a></li>
<li class="toctree-l4"><a class="reference internal" href="#thompson-sampling">Thompson Sampling</a></li>
<li class="toctree-l4"><a class="reference internal" href="#k-nearest-neighbours">K Nearest Neighbours</a></li>
<li class="toctree-l4"><a class="reference internal" href="#alternating-least-squares">Alternating Least Squares</a></li>
<li class="toctree-l4"><a class="reference internal" href="#alternating-least-squares-on-scala-experimental">Alternating Least Squares on Scala (Experimental)</a></li>
<li class="toctree-l4"><a class="reference internal" href="#slim">SLIM</a></li>
<li class="toctree-l4"><a class="reference internal" href="#word2vec-recommender">Word2Vec Recommender</a></li>
<li class="toctree-l4"><a class="reference internal" href="#association-rules-item-to-item-recommender">Association Rules Item-to-Item Recommender</a></li>
<li class="toctree-l4"><a class="reference internal" href="#cluster-recommender">Cluster Recommender</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#neural-models-with-distributed-inference">Neural models with distributed inference</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#neural-matrix-factorization-experimental">Neural Matrix Factorization (Experimental)</a></li>
<li class="toctree-l4"><a class="reference internal" href="#mult-vae-experimental">Mult-VAE (Experimental)</a></li>
<li class="toctree-l4"><a class="reference internal" href="#ddpg-experimental">DDPG (Experimental)</a></li>
<li class="toctree-l4"><a class="reference internal" href="#cql-recommender-experimental">CQL Recommender (Experimental)</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#wrappers-and-other-models-with-distributed-inference">Wrappers and other models with distributed inference</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#admm-slim-experimental">ADMM SLIM (Experimental)</a></li>
<li class="toctree-l4"><a class="reference internal" href="#lightfm-experimental">LightFM (Experimental)</a></li>
<li class="toctree-l4"><a class="reference internal" href="#implicit-experimental">implicit (Experimental)</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#neural-networks-recommenders">Neural Networks recommenders</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#bert4rec">Bert4Rec</a></li>
<li class="toctree-l4"><a class="reference internal" href="#sasrec">SasRec</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="metrics.html">Metrics</a></li>
<li class="toctree-l2"><a class="reference internal" href="scenarios.html">Scenarios</a></li>
<li class="toctree-l2"><a class="reference internal" href="utils.html">Utils</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../settings.html">Settings</a></li>
<li class="toctree-l1"><a class="reference internal" href="../useful.html">Useful Info</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">RePlay</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../modules.html">Modules</a></li>
      <li class="breadcrumb-item active">Models</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/pages/modules/models.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="section" id="module-replay.models">
<span id="models"></span><h1>Models<a class="headerlink" href="#module-replay.models" title="Permalink to this heading"></a></h1>
<p>This module contains recommender system algorithms including:</p>
<ul class="simple">
<li><p>distributed models built in PySpark</p></li>
<li><p>neural networks build in PyTorch with distributed inference in PySpark</p></li>
<li><p>wrappers for commonly used recommender systems libraries andmodels with non-distributed training and distributed inference in PySpark.</p></li>
</ul>
<div class="section" id="replay-recommenders">
<h2>RePlay Recommenders<a class="headerlink" href="#replay-recommenders" title="Permalink to this heading"></a></h2>
<table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Algorithm</p></th>
<th class="head"><p>Implementation</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Popular Recommender</p></td>
<td><p>PySpark</p></td>
</tr>
<tr class="row-odd"><td><p>Popular By Queries</p></td>
<td><p>PySpark</p></td>
</tr>
<tr class="row-even"><td><p>Wilson Recommender</p></td>
<td><p>PySpark</p></td>
</tr>
<tr class="row-odd"><td><p>Random Recommender</p></td>
<td><p>PySpark</p></td>
</tr>
<tr class="row-even"><td><p>UCB</p></td>
<td><p>PySpark</p></td>
</tr>
<tr class="row-odd"><td><p>KL-UCB</p></td>
<td><p>PySpark/Python CPU</p></td>
</tr>
<tr class="row-even"><td><p>Thompson Sampling</p></td>
<td><p>PySpark</p></td>
</tr>
<tr class="row-odd"><td><p>K-Nearest Neighbours</p></td>
<td><p>PySpark</p></td>
</tr>
<tr class="row-even"><td><p>Alternating Least Squares</p></td>
<td><p>PySpark</p></td>
</tr>
<tr class="row-odd"><td><p>SLIM</p></td>
<td><p>PySpark</p></td>
</tr>
<tr class="row-even"><td><p>Word2Vec Recommender</p></td>
<td><p>PySpark</p></td>
</tr>
<tr class="row-odd"><td><p>Association Rules Item-to-Item Recommender</p></td>
<td><p>PySpark</p></td>
</tr>
<tr class="row-even"><td><p>Cluster Recommender</p></td>
<td><p>PySpark</p></td>
</tr>
<tr class="row-odd"><td><p>Neural Matrix Factorization (Experimental)</p></td>
<td><p>Python CPU/GPU</p></td>
</tr>
<tr class="row-even"><td><p>MultVAE (Experimental)</p></td>
<td><p>Python CPU/GPU</p></td>
</tr>
<tr class="row-odd"><td><p>DDPG (Experimental)</p></td>
<td><p>Python CPU</p></td>
</tr>
<tr class="row-even"><td><p>ADMM SLIM (Experimental)</p></td>
<td><p>Python CPU</p></td>
</tr>
<tr class="row-odd"><td><p>Wrapper for implicit (Experimental)</p></td>
<td><p>Python CPU</p></td>
</tr>
<tr class="row-even"><td><p>Wrapper for LightFM (Experimental)</p></td>
<td><p>Python CPU</p></td>
</tr>
<tr class="row-odd"><td><p>RL-based CQL Recommender (Experimental)</p></td>
<td><p>PySpark</p></td>
</tr>
</tbody>
</table>
<p>To get more info on how to choose base model, please see this  <a class="reference internal" href="../useful_data/algorithm_selection.html"><span class="doc">page</span></a>.</p>
</div>
<div class="section" id="recommender-interface">
<h2>Recommender interface<a class="headerlink" href="#recommender-interface" title="Permalink to this heading"></a></h2>
<dl class="py class">
<dt class="sig sig-object py" id="replay.models.Recommender">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">replay.models.</span></span><span class="sig-name descname"><span class="pre">Recommender</span></span><a class="headerlink" href="#replay.models.Recommender" title="Permalink to this definition"></a></dt>
<dd><p>Usual recommender class for models without features.</p>
<dl class="py method">
<dt class="sig sig-object py" id="replay.models.Recommender.fit">
<span class="sig-name descname"><span class="pre">fit</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">dataset</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#replay.models.Recommender.fit" title="Permalink to this definition"></a></dt>
<dd><p>Fit a recommendation model</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>dataset</strong> (<a class="reference internal" href="data.html#replay.data.Dataset" title="replay.data.dataset.Dataset"><code class="xref py py-class docutils literal notranslate"><span class="pre">Dataset</span></code></a>) – historical interactions with query/item features
<code class="docutils literal notranslate"><span class="pre">[user_idx,</span> <span class="pre">item_idx,</span> <span class="pre">timestamp,</span> <span class="pre">rating]</span></code></p>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p><code class="xref py py-obj docutils literal notranslate"><span class="pre">None</span></code></p>
</dd>
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="replay.models.Recommender.fit_predict">
<span class="sig-name descname"><span class="pre">fit_predict</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">dataset</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">k</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">queries</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">items</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">filter_seen_items</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">recs_file_path</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#replay.models.Recommender.fit_predict" title="Permalink to this definition"></a></dt>
<dd><p>Fit model and get recommendations</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>dataset</strong> (<a class="reference internal" href="data.html#replay.data.Dataset" title="replay.data.dataset.Dataset"><code class="xref py py-class docutils literal notranslate"><span class="pre">Dataset</span></code></a>) – historical interactions with query/item features
<code class="docutils literal notranslate"><span class="pre">[user_idx,</span> <span class="pre">item_idx,</span> <span class="pre">timestamp,</span> <span class="pre">rating]</span></code></p></li>
<li><p><strong>k</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code>) – number of recommendations for each query</p></li>
<li><p><strong>queries</strong> (<code class="xref py py-data docutils literal notranslate"><span class="pre">Union</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">DataFrame</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">Iterable</span></code>, <code class="xref py py-obj docutils literal notranslate"><span class="pre">None</span></code>]) – queries to create recommendations for
dataframe containing <code class="docutils literal notranslate"><span class="pre">[user_idx]</span></code> or <code class="docutils literal notranslate"><span class="pre">array-like</span></code>;
if <code class="docutils literal notranslate"><span class="pre">None</span></code>, recommend to all queries from <code class="docutils literal notranslate"><span class="pre">interactions</span></code></p></li>
<li><p><strong>items</strong> (<code class="xref py py-data docutils literal notranslate"><span class="pre">Union</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">DataFrame</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">Iterable</span></code>, <code class="xref py py-obj docutils literal notranslate"><span class="pre">None</span></code>]) – candidate items for recommendations
dataframe containing <code class="docutils literal notranslate"><span class="pre">[item_idx]</span></code> or <code class="docutils literal notranslate"><span class="pre">array-like</span></code>;
if <code class="docutils literal notranslate"><span class="pre">None</span></code>, take all items from <code class="docutils literal notranslate"><span class="pre">interactions</span></code>.
If it contains new items, <code class="docutils literal notranslate"><span class="pre">rating</span></code> for them will be <code class="docutils literal notranslate"><span class="pre">0</span></code>.</p></li>
<li><p><strong>filter_seen_items</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">bool</span></code>) – flag to remove seen items from recommendations based on <code class="docutils literal notranslate"><span class="pre">interactions</span></code>.</p></li>
<li><p><strong>recs_file_path</strong> (<code class="xref py py-data docutils literal notranslate"><span class="pre">Optional</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>]) – save recommendations at the given absolute path as parquet file.
If None, cached and materialized recommendations dataframe  will be returned</p></li>
</ul>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p><code class="xref py py-data docutils literal notranslate"><span class="pre">Optional</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">DataFrame</span></code>]</p>
</dd>
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>cached recommendation dataframe with columns <code class="docutils literal notranslate"><span class="pre">[user_idx,</span> <span class="pre">item_idx,</span> <span class="pre">rating]</span></code>
or None if <cite>file_path</cite> is provided</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="replay.models.Recommender.get_features">
<span class="sig-name descname"><span class="pre">get_features</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ids</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#replay.models.Recommender.get_features" title="Permalink to this definition"></a></dt>
<dd><p>Returns query or item feature vectors as a Column with type ArrayType</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>ids</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">DataFrame</span></code>) – Spark DataFrame with unique ids</p>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p><code class="xref py py-data docutils literal notranslate"><span class="pre">Optional</span></code>[<code class="xref py py-data docutils literal notranslate"><span class="pre">Tuple</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">DataFrame</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code>]]</p>
</dd>
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>feature vectors.
If a model does not have a vector for some ids they are not present in the final result.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="replay.models.Recommender.predict">
<span class="sig-name descname"><span class="pre">predict</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">dataset</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">k</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">queries</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">items</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">filter_seen_items</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">recs_file_path</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#replay.models.Recommender.predict" title="Permalink to this definition"></a></dt>
<dd><p>Get recommendations</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>dataset</strong> (<a class="reference internal" href="data.html#replay.data.Dataset" title="replay.data.dataset.Dataset"><code class="xref py py-class docutils literal notranslate"><span class="pre">Dataset</span></code></a>) – historical interactions with query/item features
<code class="docutils literal notranslate"><span class="pre">[user_idx,</span> <span class="pre">item_idx,</span> <span class="pre">timestamp,</span> <span class="pre">rating]</span></code></p></li>
<li><p><strong>k</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code>) – number of recommendations for each query</p></li>
<li><p><strong>queries</strong> (<code class="xref py py-data docutils literal notranslate"><span class="pre">Union</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">DataFrame</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">Iterable</span></code>, <code class="xref py py-obj docutils literal notranslate"><span class="pre">None</span></code>]) – queries to create recommendations for
dataframe containing <code class="docutils literal notranslate"><span class="pre">[user_idx]</span></code> or <code class="docutils literal notranslate"><span class="pre">array-like</span></code>;
if <code class="docutils literal notranslate"><span class="pre">None</span></code>, recommend to all queries from <code class="docutils literal notranslate"><span class="pre">interactions</span></code></p></li>
<li><p><strong>items</strong> (<code class="xref py py-data docutils literal notranslate"><span class="pre">Union</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">DataFrame</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">Iterable</span></code>, <code class="xref py py-obj docutils literal notranslate"><span class="pre">None</span></code>]) – candidate items for recommendations
dataframe containing <code class="docutils literal notranslate"><span class="pre">[item_idx]</span></code> or <code class="docutils literal notranslate"><span class="pre">array-like</span></code>;
if <code class="docutils literal notranslate"><span class="pre">None</span></code>, take all items from <code class="docutils literal notranslate"><span class="pre">interactions</span></code>.
If it contains new items, <code class="docutils literal notranslate"><span class="pre">rating</span></code> for them will be <code class="docutils literal notranslate"><span class="pre">0</span></code>.</p></li>
<li><p><strong>filter_seen_items</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">bool</span></code>) – flag to remove seen items from recommendations based on <code class="docutils literal notranslate"><span class="pre">interactions</span></code>.</p></li>
<li><p><strong>recs_file_path</strong> (<code class="xref py py-data docutils literal notranslate"><span class="pre">Optional</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>]) – save recommendations at the given absolute path as parquet file.
If None, cached and materialized recommendations dataframe  will be returned</p></li>
</ul>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p><code class="xref py py-data docutils literal notranslate"><span class="pre">Optional</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">DataFrame</span></code>]</p>
</dd>
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>cached recommendation dataframe with columns <code class="docutils literal notranslate"><span class="pre">[user_idx,</span> <span class="pre">item_idx,</span> <span class="pre">rating]</span></code>
or None if <cite>file_path</cite> is provided</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="replay.models.Recommender.predict_pairs">
<span class="sig-name descname"><span class="pre">predict_pairs</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">pairs</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dataset</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">recs_file_path</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">k</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#replay.models.Recommender.predict_pairs" title="Permalink to this definition"></a></dt>
<dd><p>Get recommendations for specific query-item <code class="docutils literal notranslate"><span class="pre">pairs</span></code>.
If a model can’t produce recommendation
for specific pair it is removed from the resulting dataframe.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>pairs</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">DataFrame</span></code>) – dataframe with pairs to calculate rating for, <code class="docutils literal notranslate"><span class="pre">[user_idx,</span> <span class="pre">item_idx]</span></code>.</p></li>
<li><p><strong>dataset</strong> (<code class="xref py py-data docutils literal notranslate"><span class="pre">Optional</span></code>[<a class="reference internal" href="data.html#replay.data.Dataset" title="replay.data.dataset.Dataset"><code class="xref py py-class docutils literal notranslate"><span class="pre">Dataset</span></code></a>]) – historical interactions with query/item features
<code class="docutils literal notranslate"><span class="pre">[user_idx,</span> <span class="pre">item_idx,</span> <span class="pre">timestamp,</span> <span class="pre">rating]</span></code></p></li>
<li><p><strong>recs_file_path</strong> (<code class="xref py py-data docutils literal notranslate"><span class="pre">Optional</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>]) – save recommendations at the given absolute path as parquet file.
If None, cached and materialized recommendations dataframe  will be returned</p></li>
<li><p><strong>k</strong> (<code class="xref py py-data docutils literal notranslate"><span class="pre">Optional</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code>]) – top-k items for each query from pairs.</p></li>
</ul>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p><code class="xref py py-data docutils literal notranslate"><span class="pre">Optional</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">DataFrame</span></code>]</p>
</dd>
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>cached recommendation dataframe with columns <code class="docutils literal notranslate"><span class="pre">[user_idx,</span> <span class="pre">item_idx,</span> <span class="pre">rating]</span></code>
or None if <cite>file_path</cite> is provided</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">replay.models.base_rec.</span></span><span class="sig-name descname"><span class="pre">BaseRecommender</span></span></dt>
<dd><p>Base recommender</p>
<dl class="py method">
<dt class="sig sig-object py">
<span class="sig-name descname"><span class="pre">optimize</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">train_dataset</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">test_dataset</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">param_borders=None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">criterion=&lt;class</span> <span class="pre">'replay.metrics.ndcg.NDCG'&gt;</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">k=10</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">budget=10</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">new_study=True</span></span></em><span class="sig-paren">)</span></dt>
<dd><p>Searches the best parameters with optuna.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>train_dataset</strong> (<a class="reference internal" href="data.html#replay.data.Dataset" title="replay.data.dataset.Dataset"><code class="xref py py-class docutils literal notranslate"><span class="pre">Dataset</span></code></a>) – train data</p></li>
<li><p><strong>test_dataset</strong> (<a class="reference internal" href="data.html#replay.data.Dataset" title="replay.data.dataset.Dataset"><code class="xref py py-class docutils literal notranslate"><span class="pre">Dataset</span></code></a>) – test data</p></li>
<li><p><strong>param_borders</strong> (<code class="xref py py-data docutils literal notranslate"><span class="pre">Optional</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">Dict</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">List</span></code>[<code class="xref py py-data docutils literal notranslate"><span class="pre">Any</span></code>]]]) – a dictionary with search borders, where
key is the parameter name and value is the range of possible values
<code class="docutils literal notranslate"><span class="pre">{param:</span> <span class="pre">[low,</span> <span class="pre">high]}</span></code>. In case of categorical parameters it is
all possible values: <code class="docutils literal notranslate"><span class="pre">{cat_param:</span> <span class="pre">[cat_1,</span> <span class="pre">cat_2,</span> <span class="pre">cat_3]}</span></code>.</p></li>
<li><p><strong>criterion</strong> (<a class="reference internal" href="metrics.html#replay.metrics.base_metric.Metric" title="replay.metrics.base_metric.Metric"><code class="xref py py-class docutils literal notranslate"><span class="pre">Metric</span></code></a>) – metric to use for optimization</p></li>
<li><p><strong>k</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code>) – recommendation list length</p></li>
<li><p><strong>budget</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code>) – number of points to try</p></li>
<li><p><strong>new_study</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">bool</span></code>) – keep searching with previous study or start a new study</p></li>
</ul>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p><code class="xref py py-data docutils literal notranslate"><span class="pre">Optional</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">Dict</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>, <code class="xref py py-data docutils literal notranslate"><span class="pre">Any</span></code>]]</p>
</dd>
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>dictionary with best parameters</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="distributed-models">
<h2>Distributed models<a class="headerlink" href="#distributed-models" title="Permalink to this heading"></a></h2>
<p>Models with both training and inference implemented in pyspark.</p>
<div class="section" id="popular-recommender">
<h3>Popular Recommender<a class="headerlink" href="#popular-recommender" title="Permalink to this heading"></a></h3>
<dl class="py class">
<dt class="sig sig-object py" id="replay.models.PopRec">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">replay.models.</span></span><span class="sig-name descname"><span class="pre">PopRec</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">use_rating</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">add_cold_items</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cold_weight</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.5</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#replay.models.PopRec" title="Permalink to this definition"></a></dt>
<dd><p>Recommend objects using their popularity.</p>
<p>Popularity of an item is a probability that random user rated this item.</p>
<div class="math notranslate nohighlight">
\[Popularity(i) = \dfrac{N_i}{N}\]</div>
<p><span class="math notranslate nohighlight">\(N_i\)</span> - number of users who rated item <span class="math notranslate nohighlight">\(i\)</span></p>
<p><span class="math notranslate nohighlight">\(N\)</span> - total number of users</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">replay.data.dataset</span> <span class="kn">import</span> <span class="n">Dataset</span><span class="p">,</span> <span class="n">FeatureSchema</span><span class="p">,</span> <span class="n">FeatureInfo</span><span class="p">,</span> <span class="n">FeatureHint</span><span class="p">,</span> <span class="n">FeatureType</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">replay.utils.spark_utils</span> <span class="kn">import</span> <span class="n">convert2spark</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">data_frame</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;user_id&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span> <span class="s2">&quot;item_id&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="s2">&quot;rating&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">,</span> <span class="mi">1</span><span class="p">]})</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">data_frame</span>
<span class="go">    user_id   item_id     rating</span>
<span class="go">0         1         1        0.5</span>
<span class="go">1         1         2        1.0</span>
<span class="go">2         2         2        0.1</span>
<span class="go">3         2         3        0.8</span>
<span class="go">4         3         3        0.7</span>
<span class="go">5         4         3        1.0</span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">feature_schema</span> <span class="o">=</span> <span class="n">FeatureSchema</span><span class="p">(</span>
<span class="gp">... </span>    <span class="p">[</span>
<span class="gp">... </span>        <span class="n">FeatureInfo</span><span class="p">(</span>
<span class="gp">... </span>            <span class="n">column</span><span class="o">=</span><span class="s2">&quot;user_id&quot;</span><span class="p">,</span>
<span class="gp">... </span>            <span class="n">feature_type</span><span class="o">=</span><span class="n">FeatureType</span><span class="o">.</span><span class="n">CATEGORICAL</span><span class="p">,</span>
<span class="gp">... </span>            <span class="n">feature_hint</span><span class="o">=</span><span class="n">FeatureHint</span><span class="o">.</span><span class="n">QUERY_ID</span><span class="p">,</span>
<span class="gp">... </span>        <span class="p">),</span>
<span class="gp">... </span>        <span class="n">FeatureInfo</span><span class="p">(</span>
<span class="gp">... </span>            <span class="n">column</span><span class="o">=</span><span class="s2">&quot;item_id&quot;</span><span class="p">,</span>
<span class="gp">... </span>            <span class="n">feature_type</span><span class="o">=</span><span class="n">FeatureType</span><span class="o">.</span><span class="n">CATEGORICAL</span><span class="p">,</span>
<span class="gp">... </span>            <span class="n">feature_hint</span><span class="o">=</span><span class="n">FeatureHint</span><span class="o">.</span><span class="n">ITEM_ID</span><span class="p">,</span>
<span class="gp">... </span>        <span class="p">),</span>
<span class="gp">... </span>        <span class="n">FeatureInfo</span><span class="p">(</span>
<span class="gp">... </span>            <span class="n">column</span><span class="o">=</span><span class="s2">&quot;rating&quot;</span><span class="p">,</span>
<span class="gp">... </span>            <span class="n">feature_type</span><span class="o">=</span><span class="n">FeatureType</span><span class="o">.</span><span class="n">NUMERICAL</span><span class="p">,</span>
<span class="gp">... </span>            <span class="n">feature_hint</span><span class="o">=</span><span class="n">FeatureHint</span><span class="o">.</span><span class="n">RATING</span><span class="p">,</span>
<span class="gp">... </span>        <span class="p">),</span>
<span class="gp">... </span>    <span class="p">]</span>
<span class="gp">... </span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">interactions</span> <span class="o">=</span> <span class="n">convert2spark</span><span class="p">(</span><span class="n">data_frame</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">dataset</span> <span class="o">=</span> <span class="n">Dataset</span><span class="p">(</span><span class="n">feature_schema</span><span class="p">,</span> <span class="n">interactions</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">res</span> <span class="o">=</span> <span class="n">PopRec</span><span class="p">()</span><span class="o">.</span><span class="n">fit_predict</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">res</span><span class="o">.</span><span class="n">toPandas</span><span class="p">()</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s2">&quot;user_id&quot;</span><span class="p">,</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="go">    user_id   item_id     rating</span>
<span class="go">0         1         3       0.75</span>
<span class="go">1         2         1       0.25</span>
<span class="go">2         3         2       0.50</span>
<span class="go">3         4         2       0.50</span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">res</span> <span class="o">=</span> <span class="n">PopRec</span><span class="p">()</span><span class="o">.</span><span class="n">fit_predict</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">filter_seen_items</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">res</span><span class="o">.</span><span class="n">toPandas</span><span class="p">()</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s2">&quot;user_id&quot;</span><span class="p">,</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="go">    user_id   item_id     rating</span>
<span class="go">0         1         3       0.75</span>
<span class="go">1         2         3       0.75</span>
<span class="go">2         3         3       0.75</span>
<span class="go">3         4         3       0.75</span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">res</span> <span class="o">=</span> <span class="n">PopRec</span><span class="p">(</span><span class="n">use_rating</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">fit_predict</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">res</span><span class="o">.</span><span class="n">toPandas</span><span class="p">()</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s2">&quot;user_id&quot;</span><span class="p">,</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="go">    user_id   item_id     rating</span>
<span class="go">0         1         3      0.625</span>
<span class="go">1         2         1      0.125</span>
<span class="go">2         3         2      0.275</span>
<span class="go">3         4         2      0.275</span>
</pre></div>
</div>
</dd></dl>

</div>
<div class="section" id="query-popular-recommender">
<h3>Query Popular Recommender<a class="headerlink" href="#query-popular-recommender" title="Permalink to this heading"></a></h3>
<dl class="py class">
<dt class="sig sig-object py" id="replay.models.QueryPopRec">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">replay.models.</span></span><span class="sig-name descname"><span class="pre">QueryPopRec</span></span><a class="headerlink" href="#replay.models.QueryPopRec" title="Permalink to this definition"></a></dt>
<dd><p>Recommends old objects from each query’s personal top.
Input is the number of interactions between queries and items.</p>
<p>Popularity for item <span class="math notranslate nohighlight">\(i\)</span> and query <span class="math notranslate nohighlight">\(u\)</span> is defined as the
fraction of actions with item <span class="math notranslate nohighlight">\(i\)</span> among all interactions of query <span class="math notranslate nohighlight">\(u\)</span>:</p>
<div class="math notranslate nohighlight">
\[Popularity(i_u) = \dfrac{N_iu}{N_u}\]</div>
<p><span class="math notranslate nohighlight">\(N_iu\)</span> - number of interactions of query <span class="math notranslate nohighlight">\(u\)</span> with item <span class="math notranslate nohighlight">\(i\)</span>.
<span class="math notranslate nohighlight">\(N_u\)</span> - total number of interactions of query <span class="math notranslate nohighlight">\(u\)</span>.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">replay.data.dataset</span> <span class="kn">import</span> <span class="n">Dataset</span><span class="p">,</span> <span class="n">FeatureSchema</span><span class="p">,</span> <span class="n">FeatureInfo</span><span class="p">,</span> <span class="n">FeatureHint</span><span class="p">,</span> <span class="n">FeatureType</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">replay.utils.spark_utils</span> <span class="kn">import</span> <span class="n">convert2spark</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">data_frame</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;user_id&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="s2">&quot;item_id&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="s2">&quot;rating&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]})</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">data_frame</span>
<span class="go">    user_id   item_id     rating</span>
<span class="go">0         1         1          2</span>
<span class="go">1         1         2          1</span>
<span class="go">2         3         3          1</span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">interactions</span> <span class="o">=</span> <span class="n">convert2spark</span><span class="p">(</span><span class="n">data_frame</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">feature_schema</span> <span class="o">=</span> <span class="n">FeatureSchema</span><span class="p">(</span>
<span class="gp">... </span>    <span class="p">[</span>
<span class="gp">... </span>        <span class="n">FeatureInfo</span><span class="p">(</span>
<span class="gp">... </span>            <span class="n">column</span><span class="o">=</span><span class="s2">&quot;user_id&quot;</span><span class="p">,</span>
<span class="gp">... </span>            <span class="n">feature_type</span><span class="o">=</span><span class="n">FeatureType</span><span class="o">.</span><span class="n">CATEGORICAL</span><span class="p">,</span>
<span class="gp">... </span>            <span class="n">feature_hint</span><span class="o">=</span><span class="n">FeatureHint</span><span class="o">.</span><span class="n">QUERY_ID</span><span class="p">,</span>
<span class="gp">... </span>        <span class="p">),</span>
<span class="gp">... </span>        <span class="n">FeatureInfo</span><span class="p">(</span>
<span class="gp">... </span>            <span class="n">column</span><span class="o">=</span><span class="s2">&quot;item_id&quot;</span><span class="p">,</span>
<span class="gp">... </span>            <span class="n">feature_type</span><span class="o">=</span><span class="n">FeatureType</span><span class="o">.</span><span class="n">CATEGORICAL</span><span class="p">,</span>
<span class="gp">... </span>            <span class="n">feature_hint</span><span class="o">=</span><span class="n">FeatureHint</span><span class="o">.</span><span class="n">ITEM_ID</span><span class="p">,</span>
<span class="gp">... </span>        <span class="p">),</span>
<span class="gp">... </span>        <span class="n">FeatureInfo</span><span class="p">(</span>
<span class="gp">... </span>            <span class="n">column</span><span class="o">=</span><span class="s2">&quot;rating&quot;</span><span class="p">,</span>
<span class="gp">... </span>            <span class="n">feature_type</span><span class="o">=</span><span class="n">FeatureType</span><span class="o">.</span><span class="n">NUMERICAL</span><span class="p">,</span>
<span class="gp">... </span>            <span class="n">feature_hint</span><span class="o">=</span><span class="n">FeatureHint</span><span class="o">.</span><span class="n">RATING</span><span class="p">,</span>
<span class="gp">... </span>        <span class="p">),</span>
<span class="gp">... </span>    <span class="p">]</span>
<span class="gp">... </span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">dataset</span> <span class="o">=</span> <span class="n">Dataset</span><span class="p">(</span><span class="n">feature_schema</span><span class="p">,</span> <span class="n">interactions</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">model</span> <span class="o">=</span> <span class="n">QueryPopRec</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">res</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit_predict</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">filter_seen_items</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">model</span><span class="o">.</span><span class="n">query_item_popularity</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
<span class="go">3</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">res</span><span class="o">.</span><span class="n">toPandas</span><span class="p">()</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s2">&quot;user_id&quot;</span><span class="p">,</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="go">    user_id   item_id     rating</span>
<span class="go">0         1         1   0.666667</span>
<span class="go">1         3         3   1.000000</span>
</pre></div>
</div>
</dd></dl>

</div>
<div class="section" id="wilson-recommender">
<h3>Wilson Recommender<a class="headerlink" href="#wilson-recommender" title="Permalink to this heading"></a></h3>
<p>Confidence interval for binomial distribution can be calculated as:</p>
<div class="math notranslate nohighlight">
\[WilsonScore = \frac{\widehat{p}+\frac{z_{ \frac{\alpha}{2}}^{2}}{2n}\pm z_
{\frac{\alpha}{2}}\sqrt{\frac{\widehat{p}(1-\widehat{p})+\frac{z_
{\frac{\alpha}{2}}^{2}}{4n}}{n}} }{1+\frac{z_{ \frac{\alpha}{2}}^{2}}{n}}\]</div>
<p>Where <span class="math notranslate nohighlight">\(\hat{p}\)</span> – is an observed fraction of positive ratings.</p>
<p><span class="math notranslate nohighlight">\(z_{\alpha}\)</span> 1-alpha quantile of normal distribution.</p>
<dl class="py class">
<dt class="sig sig-object py" id="replay.models.Wilson">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">replay.models.</span></span><span class="sig-name descname"><span class="pre">Wilson</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">alpha</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.05</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">add_cold_items</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cold_weight</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.5</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sample</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">seed</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#replay.models.Wilson" title="Permalink to this definition"></a></dt>
<dd><p>Calculates lower confidence bound for the confidence interval
of true fraction of positive ratings.</p>
<p><code class="docutils literal notranslate"><span class="pre">rating</span></code> must be converted to binary 0-1 form.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">replay.data.dataset</span> <span class="kn">import</span> <span class="n">Dataset</span><span class="p">,</span> <span class="n">FeatureSchema</span><span class="p">,</span> <span class="n">FeatureInfo</span><span class="p">,</span> <span class="n">FeatureHint</span><span class="p">,</span> <span class="n">FeatureType</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">replay.utils.spark_utils</span> <span class="kn">import</span> <span class="n">convert2spark</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">data_frame</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;user_id&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="s2">&quot;item_id&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="s2">&quot;rating&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]})</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">interactions</span> <span class="o">=</span> <span class="n">convert2spark</span><span class="p">(</span><span class="n">data_frame</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">feature_schema</span> <span class="o">=</span> <span class="n">FeatureSchema</span><span class="p">(</span>
<span class="gp">... </span>    <span class="p">[</span>
<span class="gp">... </span>        <span class="n">FeatureInfo</span><span class="p">(</span>
<span class="gp">... </span>            <span class="n">column</span><span class="o">=</span><span class="s2">&quot;user_id&quot;</span><span class="p">,</span>
<span class="gp">... </span>            <span class="n">feature_type</span><span class="o">=</span><span class="n">FeatureType</span><span class="o">.</span><span class="n">CATEGORICAL</span><span class="p">,</span>
<span class="gp">... </span>            <span class="n">feature_hint</span><span class="o">=</span><span class="n">FeatureHint</span><span class="o">.</span><span class="n">QUERY_ID</span><span class="p">,</span>
<span class="gp">... </span>        <span class="p">),</span>
<span class="gp">... </span>        <span class="n">FeatureInfo</span><span class="p">(</span>
<span class="gp">... </span>            <span class="n">column</span><span class="o">=</span><span class="s2">&quot;item_id&quot;</span><span class="p">,</span>
<span class="gp">... </span>            <span class="n">feature_type</span><span class="o">=</span><span class="n">FeatureType</span><span class="o">.</span><span class="n">CATEGORICAL</span><span class="p">,</span>
<span class="gp">... </span>            <span class="n">feature_hint</span><span class="o">=</span><span class="n">FeatureHint</span><span class="o">.</span><span class="n">ITEM_ID</span><span class="p">,</span>
<span class="gp">... </span>        <span class="p">),</span>
<span class="gp">... </span>        <span class="n">FeatureInfo</span><span class="p">(</span>
<span class="gp">... </span>            <span class="n">column</span><span class="o">=</span><span class="s2">&quot;rating&quot;</span><span class="p">,</span>
<span class="gp">... </span>            <span class="n">feature_type</span><span class="o">=</span><span class="n">FeatureType</span><span class="o">.</span><span class="n">NUMERICAL</span><span class="p">,</span>
<span class="gp">... </span>            <span class="n">feature_hint</span><span class="o">=</span><span class="n">FeatureHint</span><span class="o">.</span><span class="n">RATING</span><span class="p">,</span>
<span class="gp">... </span>        <span class="p">),</span>
<span class="gp">... </span>    <span class="p">]</span>
<span class="gp">... </span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">dataset</span> <span class="o">=</span> <span class="n">Dataset</span><span class="p">(</span><span class="n">feature_schema</span><span class="p">,</span> <span class="n">interactions</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">model</span> <span class="o">=</span> <span class="n">Wilson</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">model</span><span class="o">.</span><span class="n">fit_predict</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">toPandas</span><span class="p">()</span>
<span class="go">    user_id   item_id     rating</span>
<span class="go">0         1         2   0.206549</span>
<span class="go">1         2         1   0.206549</span>
</pre></div>
</div>
</dd></dl>

</div>
<div class="section" id="random-recommender">
<h3>Random Recommender<a class="headerlink" href="#random-recommender" title="Permalink to this heading"></a></h3>
<dl class="py class">
<dt class="sig sig-object py" id="replay.models.RandomRec">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">replay.models.</span></span><span class="sig-name descname"><span class="pre">RandomRec</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">distribution</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'uniform'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">alpha</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">seed</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">add_cold_items</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cold_weight</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.5</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#replay.models.RandomRec" title="Permalink to this definition"></a></dt>
<dd><p>Recommend random items, either weighted by item popularity or uniform.</p>
<div class="math notranslate nohighlight">
\[P\left(i\right)\propto N_i + \alpha\]</div>
<p><span class="math notranslate nohighlight">\(N_i\)</span> — number of users who rated item <span class="math notranslate nohighlight">\(i\)</span></p>
<dl class="simple">
<dt><span class="math notranslate nohighlight">\(\alpha\)</span> — bigger <span class="math notranslate nohighlight">\(\alpha\)</span> values increase amount of rare items in recommendations.</dt><dd><p>Must be bigger than -1. Default value is <span class="math notranslate nohighlight">\(\alpha = 0\)</span>.</p>
</dd>
</dl>
<p>Model without seed provides non-determenistic recommendations,
model with fixed seed provides reproducible recommendataions.</p>
<p>As the recommendations from <cite>predict</cite> are cached, save them to disk, or create a checkpoint
and unpersist them to get different recommendations after another <cite>predict</cite> call.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">replay.utils.session_handler</span> <span class="kn">import</span> <span class="n">get_spark_session</span><span class="p">,</span> <span class="n">State</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">spark</span> <span class="o">=</span> <span class="n">get_spark_session</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">state</span> <span class="o">=</span> <span class="n">State</span><span class="p">(</span><span class="n">spark</span><span class="p">)</span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">replay.data.dataset</span> <span class="kn">import</span> <span class="n">Dataset</span><span class="p">,</span> <span class="n">FeatureSchema</span><span class="p">,</span> <span class="n">FeatureInfo</span><span class="p">,</span> <span class="n">FeatureHint</span><span class="p">,</span> <span class="n">FeatureType</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">replay.utils.spark_utils</span> <span class="kn">import</span> <span class="n">convert2spark</span>
<span class="gp">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">interactions</span> <span class="o">=</span> <span class="n">convert2spark</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
<span class="gp">... </span>    <span class="s2">&quot;user_id&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span>
<span class="gp">... </span>    <span class="s2">&quot;item_id&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
<span class="gp">... </span><span class="p">}))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">interactions</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="go">+-------+-------+</span>
<span class="go">|user_id|item_id|</span>
<span class="go">+-------+-------+</span>
<span class="go">|      1|      1|</span>
<span class="go">|      1|      2|</span>
<span class="go">|      2|      2|</span>
<span class="go">|      2|      3|</span>
<span class="go">|      3|      3|</span>
<span class="go">|      4|      3|</span>
<span class="go">+-------+-------+</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">random_pop</span> <span class="o">=</span> <span class="n">RandomRec</span><span class="p">(</span><span class="n">distribution</span><span class="o">=</span><span class="s2">&quot;popular_based&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
<span class="gt">Traceback (most recent call last):</span>
<span class="w"> </span><span class="c">...</span>
<span class="gr">ValueError</span>: <span class="n">alpha must be bigger than -1</span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">random_pop</span> <span class="o">=</span> <span class="n">RandomRec</span><span class="p">(</span><span class="n">distribution</span><span class="o">=</span><span class="s2">&quot;abracadabra&quot;</span><span class="p">)</span>
<span class="gt">Traceback (most recent call last):</span>
<span class="w"> </span><span class="c">...</span>
<span class="gr">ValueError</span>: <span class="n">distribution can be one of [popular_based, relevance, uniform]</span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">feature_schema</span> <span class="o">=</span> <span class="n">FeatureSchema</span><span class="p">(</span>
<span class="gp">... </span>    <span class="p">[</span>
<span class="gp">... </span>        <span class="n">FeatureInfo</span><span class="p">(</span>
<span class="gp">... </span>            <span class="n">column</span><span class="o">=</span><span class="s2">&quot;user_id&quot;</span><span class="p">,</span>
<span class="gp">... </span>            <span class="n">feature_type</span><span class="o">=</span><span class="n">FeatureType</span><span class="o">.</span><span class="n">CATEGORICAL</span><span class="p">,</span>
<span class="gp">... </span>            <span class="n">feature_hint</span><span class="o">=</span><span class="n">FeatureHint</span><span class="o">.</span><span class="n">QUERY_ID</span><span class="p">,</span>
<span class="gp">... </span>        <span class="p">),</span>
<span class="gp">... </span>        <span class="n">FeatureInfo</span><span class="p">(</span>
<span class="gp">... </span>            <span class="n">column</span><span class="o">=</span><span class="s2">&quot;item_id&quot;</span><span class="p">,</span>
<span class="gp">... </span>            <span class="n">feature_type</span><span class="o">=</span><span class="n">FeatureType</span><span class="o">.</span><span class="n">CATEGORICAL</span><span class="p">,</span>
<span class="gp">... </span>            <span class="n">feature_hint</span><span class="o">=</span><span class="n">FeatureHint</span><span class="o">.</span><span class="n">ITEM_ID</span><span class="p">,</span>
<span class="gp">... </span>        <span class="p">),</span>
<span class="gp">... </span>    <span class="p">]</span>
<span class="gp">... </span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">dataset</span> <span class="o">=</span> <span class="n">Dataset</span><span class="p">(</span><span class="n">feature_schema</span><span class="p">,</span> <span class="n">interactions</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">random_pop</span> <span class="o">=</span> <span class="n">RandomRec</span><span class="p">(</span><span class="n">distribution</span><span class="o">=</span><span class="s2">&quot;popular_based&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="mi">777</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">random_pop</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">dataset</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">random_pop</span><span class="o">.</span><span class="n">item_popularity</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="go">+-------+------------------+</span>
<span class="go">|item_id|            rating|</span>
<span class="go">+-------+------------------+</span>
<span class="go">|      1|0.2222222222222222|</span>
<span class="go">|      2|0.3333333333333333|</span>
<span class="go">|      3|0.4444444444444444|</span>
<span class="go">+-------+------------------+</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">recs</span> <span class="o">=</span> <span class="n">random_pop</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">recs</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="go">+-------+-------+------------------+</span>
<span class="go">|user_id|item_id|            rating|</span>
<span class="go">+-------+-------+------------------+</span>
<span class="go">|      1|      3|0.3333333333333333|</span>
<span class="go">|      2|      1|               0.5|</span>
<span class="go">|      3|      2|               1.0|</span>
<span class="go">|      3|      1|0.3333333333333333|</span>
<span class="go">|      4|      2|               1.0|</span>
<span class="go">|      4|      1|               0.5|</span>
<span class="go">+-------+-------+------------------+</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">recs</span> <span class="o">=</span> <span class="n">random_pop</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">queries</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">items</span><span class="o">=</span><span class="p">[</span><span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">recs</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="go">+-------+-------+------+</span>
<span class="go">|user_id|item_id|rating|</span>
<span class="go">+-------+-------+------+</span>
<span class="go">|      1|      7|   1.0|</span>
<span class="go">|      1|      8|   0.5|</span>
<span class="go">+-------+-------+------+</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">random_pop</span> <span class="o">=</span> <span class="n">RandomRec</span><span class="p">(</span><span class="n">seed</span><span class="o">=</span><span class="mi">555</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">random_pop</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">dataset</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">random_pop</span><span class="o">.</span><span class="n">item_popularity</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="go">+-------+------------------+</span>
<span class="go">|item_id|            rating|</span>
<span class="go">+-------+------------------+</span>
<span class="go">|      1|0.3333333333333333|</span>
<span class="go">|      2|0.3333333333333333|</span>
<span class="go">|      3|0.3333333333333333|</span>
<span class="go">+-------+------------------+</span>
</pre></div>
</div>
<dl class="py method">
<dt class="sig sig-object py" id="replay.models.RandomRec.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">distribution</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'uniform'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">alpha</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">seed</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">add_cold_items</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cold_weight</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.5</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#replay.models.RandomRec.__init__" title="Permalink to this definition"></a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>distribution</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>) – recommendation strategy:
“uniform” - all items are sampled uniformly
“popular_based” - recommend popular items more</p></li>
<li><p><strong>alpha</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code>) – bigger values adjust model towards less popular items</p></li>
<li><p><strong>seed</strong> (<code class="xref py py-data docutils literal notranslate"><span class="pre">Optional</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code>]) – random seed</p></li>
<li><p><strong>add_cold_items</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">bool</span></code>) – flag to consider cold items in recommendations building
if present in <cite>items</cite> parameter of <cite>predict</cite> method
or <cite>pairs</cite> parameter of <cite>predict_pairs</cite> methods.
If true, cold items are assigned relevance equals to the less relevant item relevance
multiplied by <cite>cold_weight</cite> and may appear among top-K recommendations.
Otherwise cold items are filtered out.
Could be changed after model training by setting the <cite>add_cold_items</cite> attribute.</p></li>
<li><p><strong>cold_weight</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code>) – if <cite>add_cold_items</cite> is True,
cold items are added with reduced relevance.
The relevance for cold items is equal to the relevance
of a least relevant item multiplied by a <cite>cold_weight</cite> value.
<cite>Cold_weight</cite> value should be in interval (0, 1].</p></li>
</ul>
</dd>
</dl>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="ucb-recommender">
<h3>UCB Recommender<a class="headerlink" href="#ucb-recommender" title="Permalink to this heading"></a></h3>
<dl class="py class">
<dt class="sig sig-object py" id="replay.models.UCB">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">replay.models.</span></span><span class="sig-name descname"><span class="pre">UCB</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">exploration_coef</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">2</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sample</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">seed</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#replay.models.UCB" title="Permalink to this definition"></a></dt>
<dd><p>Simple bandit model, which caclulate item rating as upper confidence bound
(<a class="reference external" href="https://medium.com/analytics-vidhya/multi-armed-bandit-analysis-of-upper-confidence-bound-algorithm-4b84be516047">UCB</a>)
for the confidence interval of true fraction of positive ratings.
Should be used in iterative (online) mode to achive proper recommendation quality.</p>
<p><code class="docutils literal notranslate"><span class="pre">rating</span></code> from interactions must be converted to binary 0-1 form.</p>
<div class="math notranslate nohighlight">
\[pred_i = ctr_i + \sqrt{\frac{c\ln{n}}{n_i}}\]</div>
<p><span class="math notranslate nohighlight">\(pred_i\)</span> – predicted rating of item <span class="math notranslate nohighlight">\(i\)</span>
<span class="math notranslate nohighlight">\(c\)</span> – exploration coeficient
<span class="math notranslate nohighlight">\(n\)</span> – number of interactions in log
<span class="math notranslate nohighlight">\(n_i\)</span> – number of interactions with item <span class="math notranslate nohighlight">\(i\)</span></p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">replay.data.dataset</span> <span class="kn">import</span> <span class="n">Dataset</span><span class="p">,</span> <span class="n">FeatureSchema</span><span class="p">,</span> <span class="n">FeatureInfo</span><span class="p">,</span> <span class="n">FeatureHint</span><span class="p">,</span> <span class="n">FeatureType</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">replay.utils.spark_utils</span> <span class="kn">import</span> <span class="n">convert2spark</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">data_frame</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;user_id&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="s2">&quot;item_id&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="s2">&quot;rating&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]})</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">interactions</span> <span class="o">=</span> <span class="n">convert2spark</span><span class="p">(</span><span class="n">data_frame</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">feature_schema</span> <span class="o">=</span> <span class="n">FeatureSchema</span><span class="p">(</span>
<span class="gp">... </span>    <span class="p">[</span>
<span class="gp">... </span>        <span class="n">FeatureInfo</span><span class="p">(</span>
<span class="gp">... </span>            <span class="n">column</span><span class="o">=</span><span class="s2">&quot;user_id&quot;</span><span class="p">,</span>
<span class="gp">... </span>            <span class="n">feature_type</span><span class="o">=</span><span class="n">FeatureType</span><span class="o">.</span><span class="n">CATEGORICAL</span><span class="p">,</span>
<span class="gp">... </span>            <span class="n">feature_hint</span><span class="o">=</span><span class="n">FeatureHint</span><span class="o">.</span><span class="n">QUERY_ID</span><span class="p">,</span>
<span class="gp">... </span>        <span class="p">),</span>
<span class="gp">... </span>        <span class="n">FeatureInfo</span><span class="p">(</span>
<span class="gp">... </span>            <span class="n">column</span><span class="o">=</span><span class="s2">&quot;item_id&quot;</span><span class="p">,</span>
<span class="gp">... </span>            <span class="n">feature_type</span><span class="o">=</span><span class="n">FeatureType</span><span class="o">.</span><span class="n">CATEGORICAL</span><span class="p">,</span>
<span class="gp">... </span>            <span class="n">feature_hint</span><span class="o">=</span><span class="n">FeatureHint</span><span class="o">.</span><span class="n">ITEM_ID</span><span class="p">,</span>
<span class="gp">... </span>        <span class="p">),</span>
<span class="gp">... </span>        <span class="n">FeatureInfo</span><span class="p">(</span>
<span class="gp">... </span>            <span class="n">column</span><span class="o">=</span><span class="s2">&quot;rating&quot;</span><span class="p">,</span>
<span class="gp">... </span>            <span class="n">feature_type</span><span class="o">=</span><span class="n">FeatureType</span><span class="o">.</span><span class="n">NUMERICAL</span><span class="p">,</span>
<span class="gp">... </span>            <span class="n">feature_hint</span><span class="o">=</span><span class="n">FeatureHint</span><span class="o">.</span><span class="n">RATING</span><span class="p">,</span>
<span class="gp">... </span>        <span class="p">),</span>
<span class="gp">... </span>    <span class="p">]</span>
<span class="gp">... </span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">dataset</span> <span class="o">=</span> <span class="n">Dataset</span><span class="p">(</span><span class="n">feature_schema</span><span class="p">,</span> <span class="n">interactions</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">model</span> <span class="o">=</span> <span class="n">UCB</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">dataset</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">queries</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">],</span> <span class="n">items</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">]</span>
<span class="gp">... </span><span class="p">)</span><span class="o">.</span><span class="n">toPandas</span><span class="p">()</span><span class="o">.</span><span class="n">sort_values</span><span class="p">([</span><span class="s2">&quot;user_id&quot;</span><span class="p">,</span><span class="s2">&quot;rating&quot;</span><span class="p">,</span><span class="s2">&quot;item_id&quot;</span><span class="p">],</span>
<span class="gp">... </span><span class="n">ascending</span><span class="o">=</span><span class="p">[</span><span class="kc">True</span><span class="p">,</span><span class="kc">False</span><span class="p">,</span><span class="kc">True</span><span class="p">])</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="go">    user_id   item_id     rating</span>
<span class="go">0         1         3   2.665109</span>
<span class="go">1         1         2   1.177410</span>
<span class="go">2         2         3   2.665109</span>
<span class="go">3         2         1   1.677410</span>
<span class="go">4         3         3   2.665109</span>
<span class="go">5         4         3   2.665109</span>
<span class="go">6         4         1   1.677410</span>
</pre></div>
</div>
<dl class="py method">
<dt class="sig sig-object py" id="replay.models.UCB.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">exploration_coef</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">2</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sample</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">seed</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#replay.models.UCB.__init__" title="Permalink to this definition"></a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>exploration_coef</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code>) – exploration coefficient</p></li>
<li><p><strong>sample</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">bool</span></code>) – flag to choose recommendation strategy.
If True, items are sampled with a probability proportional
to the calculated predicted rating.
Could be changed after model training by setting the <cite>sample</cite> attribute.</p></li>
<li><p><strong>seed</strong> (<code class="xref py py-data docutils literal notranslate"><span class="pre">Optional</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code>]) – random seed. Provides reproducibility if fixed</p></li>
</ul>
</dd>
</dl>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="kl-ucb-recommender">
<h3>KL-UCB Recommender<a class="headerlink" href="#kl-ucb-recommender" title="Permalink to this heading"></a></h3>
<dl class="py class">
<dt class="sig sig-object py" id="replay.models.KLUCB">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">replay.models.</span></span><span class="sig-name descname"><span class="pre">KLUCB</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">exploration_coef</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sample</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">seed</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#replay.models.KLUCB" title="Permalink to this definition"></a></dt>
<dd><p>Bernoulli <a class="reference external" href="https://en.wikipedia.org/wiki/Multi-armed_bandit">bandit model</a>. Same to <a class="reference internal" href="#replay.models.UCB" title="replay.models.UCB"><code class="xref py py-class docutils literal notranslate"><span class="pre">UCB</span></code></a>
computes item relevance as an upper confidence bound of true fraction of
positive interactions.</p>
<p>In a nutshell, KL-UCB сonsiders the data as the history of interactions
with items. The interaction may be either positive or negative. For each
item the model computes empirical frequency of positive interactions
and estimates the true frequency with an upper confidence bound. The higher
the bound for an item is the more relevant it is presumed.</p>
<p>The upper bound below is what differs from the classical UCB. It is
computed according to the <a class="reference external" href="https://arxiv.org/pdf/1102.2490.pdf">original article</a> where is proven to produce
assymptotically better results.</p>
<div class="math notranslate nohighlight">
\[u_i = \max q \in [0,1] :
n_i \cdot \operatorname{KL}\left(\frac{p_i}{n_i}, q \right)
\leqslant \log(n) + c \log(\log(n)),\]</div>
<p>where</p>
<p><span class="math notranslate nohighlight">\(u_i\)</span> – upper bound for item <span class="math notranslate nohighlight">\(i\)</span>,</p>
<p><span class="math notranslate nohighlight">\(c\)</span> – exploration coeficient,</p>
<p><span class="math notranslate nohighlight">\(n\)</span> – number of interactions in log,</p>
<p><span class="math notranslate nohighlight">\(n_i\)</span> – number of interactions with item <span class="math notranslate nohighlight">\(i\)</span>,</p>
<p><span class="math notranslate nohighlight">\(p_i\)</span> – number of positive interactions with item <span class="math notranslate nohighlight">\(i\)</span>,</p>
<p>and</p>
<div class="math notranslate nohighlight">
\[\operatorname{KL}(p, q)
= p \log\frac{p}{q} + (1-p)\log\frac{1-p}{1-q}\]</div>
<p>is the KL-divergence of Bernoulli distribution with parameter <span class="math notranslate nohighlight">\(p\)</span>
from Bernoulli distribution with parameter <span class="math notranslate nohighlight">\(q\)</span>.</p>
<p>Being a bit trickier though, the bound shares with UCB the same
exploration-exploitation tradeoff dilemma. You may increase the <cite>c</cite>
coefficient in order to shift the tradeoff towards exploration or decrease
it to set the model to be more sceptical of items with small volume of
collected statistics. The authors of the <a class="reference external" href="https://arxiv.org/pdf/1102.2490.pdf">article</a> though claim <cite>c = 0</cite> to be of the
best choice in practice.</p>
<p>As any other RePlay model, KL-UCB takes a log to fit on as a <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code>
with columns <code class="docutils literal notranslate"><span class="pre">[user_idx,</span> <span class="pre">item_idx,</span> <span class="pre">timestamp,</span> <span class="pre">relevance]</span></code>. Following the
procedure above, KL-UCB would see each row as a record of an interaction
with <code class="docutils literal notranslate"><span class="pre">item_idx</span></code> with positive (relevance = 1) or negative (relevance = 0)
outcome. <code class="docutils literal notranslate"><span class="pre">user_idx</span></code> and <code class="docutils literal notranslate"><span class="pre">timestamp</span></code> are ignored i.e. the model treats
log as non-personalized - item scores are same for all users.</p>
<p>If <code class="docutils literal notranslate"><span class="pre">relevance</span></code> column is not of 0/1 initially, then you have to decide
what kind of relevance has to be considered as positive and convert
<code class="docutils literal notranslate"><span class="pre">relevance</span></code> to binary format during preprocessing.</p>
<p>To provide a prediction, KL-UCB would sample a set of recommended items for
each user with probabilites proportional to obtained relevances.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">replay.data.dataset</span> <span class="kn">import</span> <span class="n">Dataset</span><span class="p">,</span> <span class="n">FeatureSchema</span><span class="p">,</span> <span class="n">FeatureInfo</span><span class="p">,</span> <span class="n">FeatureHint</span><span class="p">,</span> <span class="n">FeatureType</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">replay.utils.spark_utils</span> <span class="kn">import</span> <span class="n">convert2spark</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">data_frame</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;user_id&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="s2">&quot;item_id&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="s2">&quot;rating&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]})</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">interactions</span> <span class="o">=</span> <span class="n">convert2spark</span><span class="p">(</span><span class="n">data_frame</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">feature_schema</span> <span class="o">=</span> <span class="n">FeatureSchema</span><span class="p">(</span>
<span class="gp">... </span>    <span class="p">[</span>
<span class="gp">... </span>        <span class="n">FeatureInfo</span><span class="p">(</span>
<span class="gp">... </span>            <span class="n">column</span><span class="o">=</span><span class="s2">&quot;user_id&quot;</span><span class="p">,</span>
<span class="gp">... </span>            <span class="n">feature_type</span><span class="o">=</span><span class="n">FeatureType</span><span class="o">.</span><span class="n">CATEGORICAL</span><span class="p">,</span>
<span class="gp">... </span>            <span class="n">feature_hint</span><span class="o">=</span><span class="n">FeatureHint</span><span class="o">.</span><span class="n">QUERY_ID</span><span class="p">,</span>
<span class="gp">... </span>        <span class="p">),</span>
<span class="gp">... </span>        <span class="n">FeatureInfo</span><span class="p">(</span>
<span class="gp">... </span>            <span class="n">column</span><span class="o">=</span><span class="s2">&quot;item_id&quot;</span><span class="p">,</span>
<span class="gp">... </span>            <span class="n">feature_type</span><span class="o">=</span><span class="n">FeatureType</span><span class="o">.</span><span class="n">CATEGORICAL</span><span class="p">,</span>
<span class="gp">... </span>            <span class="n">feature_hint</span><span class="o">=</span><span class="n">FeatureHint</span><span class="o">.</span><span class="n">ITEM_ID</span><span class="p">,</span>
<span class="gp">... </span>        <span class="p">),</span>
<span class="gp">... </span>        <span class="n">FeatureInfo</span><span class="p">(</span>
<span class="gp">... </span>            <span class="n">column</span><span class="o">=</span><span class="s2">&quot;rating&quot;</span><span class="p">,</span>
<span class="gp">... </span>            <span class="n">feature_type</span><span class="o">=</span><span class="n">FeatureType</span><span class="o">.</span><span class="n">NUMERICAL</span><span class="p">,</span>
<span class="gp">... </span>            <span class="n">feature_hint</span><span class="o">=</span><span class="n">FeatureHint</span><span class="o">.</span><span class="n">RATING</span><span class="p">,</span>
<span class="gp">... </span>        <span class="p">),</span>
<span class="gp">... </span>    <span class="p">]</span>
<span class="gp">... </span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">dataset</span> <span class="o">=</span> <span class="n">Dataset</span><span class="p">(</span><span class="n">feature_schema</span><span class="p">,</span> <span class="n">interactions</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">model</span> <span class="o">=</span> <span class="n">KLUCB</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">dataset</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">queries</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">],</span> <span class="n">items</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">]</span>
<span class="gp">... </span><span class="p">)</span><span class="o">.</span><span class="n">toPandas</span><span class="p">()</span><span class="o">.</span><span class="n">sort_values</span><span class="p">([</span><span class="s2">&quot;user_id&quot;</span><span class="p">,</span><span class="s2">&quot;rating&quot;</span><span class="p">,</span><span class="s2">&quot;item_id&quot;</span><span class="p">],</span>
<span class="gp">... </span><span class="n">ascending</span><span class="o">=</span><span class="p">[</span><span class="kc">True</span><span class="p">,</span><span class="kc">False</span><span class="p">,</span><span class="kc">True</span><span class="p">])</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="go">    user_id   item_id     rating</span>
<span class="go">0         1         3   1.000000</span>
<span class="go">1         1         2   0.750000</span>
<span class="go">2         2         3   1.000000</span>
<span class="go">3         2         1   0.933013</span>
<span class="go">4         3         3   1.000000</span>
<span class="go">5         4         3   1.000000</span>
<span class="go">6         4         1   0.933013</span>
</pre></div>
</div>
<dl class="py method">
<dt class="sig sig-object py" id="replay.models.KLUCB.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">exploration_coef</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sample</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">seed</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#replay.models.KLUCB.__init__" title="Permalink to this definition"></a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>exploration_coef</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code>) – exploration coefficient</p></li>
<li><p><strong>sample</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">bool</span></code>) – flag to choose recommendation strategy.
If True, items are sampled with a probability proportional
to the calculated predicted relevance.
Could be changed after model training by setting the <cite>sample</cite>
attribute.</p></li>
<li><p><strong>seed</strong> (<code class="xref py py-data docutils literal notranslate"><span class="pre">Optional</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code>]) – random seed. Provides reproducibility if fixed</p></li>
</ul>
</dd>
</dl>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="thompson-sampling">
<h3>Thompson Sampling<a class="headerlink" href="#thompson-sampling" title="Permalink to this heading"></a></h3>
<dl class="py class">
<dt class="sig sig-object py" id="replay.models.ThompsonSampling">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">replay.models.</span></span><span class="sig-name descname"><span class="pre">ThompsonSampling</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">sample</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">seed</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#replay.models.ThompsonSampling" title="Permalink to this definition"></a></dt>
<dd><p>Thompson Sampling recommender.</p>
<p>Bandit model with <a class="reference external" href="https://proceedings.neurips.cc/paper/2011/file/e53a0a2978c28872a4505bdb51db06dc-Paper.pdf">efficient exploration-exploitation balance</a>.
The reward probability of each of the K arms is modeled by a Beta distribution
which is updated after an arm is selected. The initial prior distribution is Beta(1,1).</p>
<dl class="py method">
<dt class="sig sig-object py" id="replay.models.ThompsonSampling.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">sample</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">seed</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#replay.models.ThompsonSampling.__init__" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

</dd></dl>

</div>
<div class="section" id="k-nearest-neighbours">
<h3>K Nearest Neighbours<a class="headerlink" href="#k-nearest-neighbours" title="Permalink to this heading"></a></h3>
<dl class="py class">
<dt class="sig sig-object py" id="replay.models.ItemKNN">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">replay.models.</span></span><span class="sig-name descname"><span class="pre">ItemKNN</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">num_neighbours</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">10</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">use_rating</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">shrink</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">weighting</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">index_builder</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#replay.models.ItemKNN" title="Permalink to this definition"></a></dt>
<dd><p>Item-based ItemKNN with modified cosine similarity measure.</p>
<dl class="py method">
<dt class="sig sig-object py" id="replay.models.ItemKNN.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">num_neighbours</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">10</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">use_rating</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">shrink</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">weighting</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">index_builder</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#replay.models.ItemKNN.__init__" title="Permalink to this definition"></a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>num_neighbours</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code>) – number of neighbours</p></li>
<li><p><strong>use_rating</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">bool</span></code>) – flag to use rating values as is or to treat them as 1</p></li>
<li><p><strong>shrink</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code>) – term added to the denominator when calculating similarity</p></li>
<li><p><strong>weighting</strong> (<code class="xref py py-data docutils literal notranslate"><span class="pre">Optional</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>]) – item reweighting type, one of [None, ‘tf_idf’, ‘bm25’]</p></li>
<li><p><strong>index_builder</strong> (<code class="xref py py-data docutils literal notranslate"><span class="pre">Optional</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">IndexBuilder</span></code>]) – <cite>IndexBuilder</cite> instance that adds ANN functionality.
If not set, then ann will not be used.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="alternating-least-squares">
<span id="als-rec"></span><h3>Alternating Least Squares<a class="headerlink" href="#alternating-least-squares" title="Permalink to this heading"></a></h3>
<dl class="py class">
<dt class="sig sig-object py" id="replay.models.ALSWrap">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">replay.models.</span></span><span class="sig-name descname"><span class="pre">ALSWrap</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">rank</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">10</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">implicit_prefs</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">seed</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">num_item_blocks</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">num_query_blocks</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#replay.models.ALSWrap" title="Permalink to this definition"></a></dt>
<dd><p>Wrapper for <a class="reference external" href="https://spark.apache.org/docs/latest/api/python/pyspark.mllib.html#pyspark.mllib.recommendation.ALS">Spark ALS</a>.</p>
<dl class="py method">
<dt class="sig sig-object py" id="replay.models.ALSWrap.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">rank</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">10</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">implicit_prefs</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">seed</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">num_item_blocks</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">num_query_blocks</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#replay.models.ALSWrap.__init__" title="Permalink to this definition"></a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>rank</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code>) – hidden dimension for the approximate matrix</p></li>
<li><p><strong>implicit_prefs</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">bool</span></code>) – flag to use implicit feedback</p></li>
<li><p><strong>seed</strong> (<code class="xref py py-data docutils literal notranslate"><span class="pre">Optional</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code>]) – random seed</p></li>
<li><p><strong>num_item_blocks</strong> (<code class="xref py py-data docutils literal notranslate"><span class="pre">Optional</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code>]) – number of blocks the items will be partitioned into in order
to parallelize computation.
if None then will be init with number of partitions of interactions.</p></li>
<li><p><strong>num_query_blocks</strong> (<code class="xref py py-data docutils literal notranslate"><span class="pre">Optional</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code>]) – number of blocks the queries will be partitioned into in order
to parallelize computation.
if None then will be init with number of partitions of interactions.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="alternating-least-squares-on-scala-experimental">
<h3>Alternating Least Squares on Scala (Experimental)<a class="headerlink" href="#alternating-least-squares-on-scala-experimental" title="Permalink to this heading"></a></h3>
<dl class="py class">
<dt class="sig sig-object py" id="replay.experimental.models.ScalaALSWrap">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">replay.experimental.models.</span></span><span class="sig-name descname"><span class="pre">ScalaALSWrap</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">rank</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">10</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">implicit_prefs</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">seed</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">num_item_blocks</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">num_user_blocks</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">index_builder</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#replay.experimental.models.ScalaALSWrap" title="Permalink to this definition"></a></dt>
<dd><p>Wrapper for <a class="reference external" href="https://spark.apache.org/docs/latest/api/python/pyspark.mllib.html#pyspark.mllib.recommendation.ALS">Spark ALS</a>.</p>
<dl class="py method">
<dt class="sig sig-object py" id="replay.experimental.models.ScalaALSWrap.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">rank</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">10</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">implicit_prefs</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">seed</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">num_item_blocks</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">num_user_blocks</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">index_builder</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#replay.experimental.models.ScalaALSWrap.__init__" title="Permalink to this definition"></a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>rank</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code>) – hidden dimension for the approximate matrix</p></li>
<li><p><strong>implicit_prefs</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">bool</span></code>) – flag to use implicit feedback</p></li>
<li><p><strong>seed</strong> (<code class="xref py py-data docutils literal notranslate"><span class="pre">Optional</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code>]) – random seed</p></li>
<li><p><strong>num_item_blocks</strong> (<code class="xref py py-data docutils literal notranslate"><span class="pre">Optional</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code>]) – number of blocks the items will be partitioned into in order
to parallelize computation.
if None then will be init with number of partitions of log.</p></li>
<li><p><strong>num_user_blocks</strong> (<code class="xref py py-data docutils literal notranslate"><span class="pre">Optional</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code>]) – number of blocks the users will be partitioned into in order
to parallelize computation.
if None then will be init with number of partitions of log.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="slim">
<h3>SLIM<a class="headerlink" href="#slim" title="Permalink to this heading"></a></h3>
<p>SLIM Recommender calculates similarity between objects to produce recommendations <span class="math notranslate nohighlight">\(W\)</span>.</p>
<p>Loss function is:</p>
<div class="math notranslate nohighlight">
\[L = \frac 12||A - A W||^2_F + \frac \beta 2 ||W||_F^2+
\lambda
||W||_1\]</div>
<p><span class="math notranslate nohighlight">\(W\)</span> – item similarity matrix</p>
<p><span class="math notranslate nohighlight">\(A\)</span> – interaction matrix</p>
<p>Finding <span class="math notranslate nohighlight">\(W\)</span> can be splitted into solving separate linear regressions with ElasticNet regularization.
Thus each row in <span class="math notranslate nohighlight">\(W\)</span> is optimized with</p>
<div class="math notranslate nohighlight">
\[l = \frac 12||a_j - A w_j||^2_2 + \frac \beta 2 ||w_j||_2^2+
\lambda ||w_j||_1\]</div>
<p>To remove trivial solution, we add an extra requirements <span class="math notranslate nohighlight">\(w_{jj}=0\)</span>,
and <span class="math notranslate nohighlight">\(w_{ij}\ge 0\)</span></p>
<dl class="py class">
<dt class="sig sig-object py" id="replay.models.SLIM">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">replay.models.</span></span><span class="sig-name descname"><span class="pre">SLIM</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">beta</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.01</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">lambda_</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.01</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">seed</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">index_builder</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#replay.models.SLIM" title="Permalink to this definition"></a></dt>
<dd><p><a class="reference external" href="http://glaros.dtc.umn.edu/gkhome/fetch/papers/SLIM2011icdm.pdf">SLIM: Sparse Linear Methods for Top-N Recommender Systems</a></p>
<dl class="py method">
<dt class="sig sig-object py" id="replay.models.SLIM.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">beta</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.01</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">lambda_</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.01</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">seed</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">index_builder</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#replay.models.SLIM.__init__" title="Permalink to this definition"></a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>beta</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code>) – l2 regularization</p></li>
<li><p><strong>lambda</strong> – l1 regularization</p></li>
<li><p><strong>seed</strong> (<code class="xref py py-data docutils literal notranslate"><span class="pre">Optional</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code>]) – random seed</p></li>
<li><p><strong>index_builder</strong> (<code class="xref py py-data docutils literal notranslate"><span class="pre">Optional</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">IndexBuilder</span></code>]) – <cite>IndexBuilder</cite> instance that adds ANN functionality.
If not set, then ann will not be used.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="word2vec-recommender">
<h3>Word2Vec Recommender<a class="headerlink" href="#word2vec-recommender" title="Permalink to this heading"></a></h3>
<dl class="py class">
<dt class="sig sig-object py" id="replay.models.Word2VecRec">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">replay.models.</span></span><span class="sig-name descname"><span class="pre">Word2VecRec</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">rank</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">100</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">min_count</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">5</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">step_size</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.025</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">max_iter</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">window_size</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">use_idf</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">seed</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">num_partitions</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">index_builder</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#replay.models.Word2VecRec" title="Permalink to this definition"></a></dt>
<dd><p>Trains word2vec model where items are treated as words and queries as sentences.</p>
<dl class="py method">
<dt class="sig sig-object py" id="replay.models.Word2VecRec.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">rank</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">100</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">min_count</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">5</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">step_size</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.025</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">max_iter</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">window_size</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">use_idf</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">seed</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">num_partitions</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">index_builder</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#replay.models.Word2VecRec.__init__" title="Permalink to this definition"></a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>rank</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code>) – embedding size</p></li>
<li><p><strong>min_count</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code>) – the minimum number of times a token must
appear to be included in the word2vec model’s vocabulary</p></li>
<li><p><strong>step_size</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code>) – step size to be used for each iteration of optimization</p></li>
<li><p><strong>max_iter</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code>) – max number of iterations</p></li>
<li><p><strong>window_size</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code>) – window size</p></li>
<li><p><strong>use_idf</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">bool</span></code>) – flag to use inverse document frequency</p></li>
<li><p><strong>seed</strong> (<code class="xref py py-data docutils literal notranslate"><span class="pre">Optional</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code>]) – random seed</p></li>
<li><p><strong>index_builder</strong> (<code class="xref py py-data docutils literal notranslate"><span class="pre">Optional</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">IndexBuilder</span></code>]) – <cite>IndexBuilder</cite> instance that adds ANN functionality.
If not set, then ann will not be used.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="association-rules-item-to-item-recommender">
<h3>Association Rules Item-to-Item Recommender<a class="headerlink" href="#association-rules-item-to-item-recommender" title="Permalink to this heading"></a></h3>
<dl class="py class">
<dt class="sig sig-object py" id="replay.models.AssociationRulesItemRec">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">replay.models.</span></span><span class="sig-name descname"><span class="pre">AssociationRulesItemRec</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">session_column</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">min_item_count</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">5</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">min_pair_count</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">5</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">num_neighbours</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1000</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">use_rating</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">similarity_metric</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'confidence'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">index_builder</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#replay.models.AssociationRulesItemRec" title="Permalink to this definition"></a></dt>
<dd><p>Item-to-item recommender based on association rules.
Calculate pairs confidence, lift and confidence_gain defined as
confidence(a, b)/confidence(!a, b) to get top-k associated items.
Predict items for queries using lift, confidence or confidence_gain metrics.</p>
<p>Forecasts will be based on indicators: lift, confidence or confidence_gain.
It all depends on your choice.</p>
<p>During class initialization, you can explicitly specify the metric to be used as
a similarity for calculating the predict.</p>
<p>You can change your selection before calling <cite>.predict()</cite> or <cite>.predict_pairs()</cite>
if you set a new value for the <cite>similarity_metric</cite> parameter.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">replay.data.dataset</span> <span class="kn">import</span> <span class="n">Dataset</span><span class="p">,</span> <span class="n">FeatureSchema</span><span class="p">,</span> <span class="n">FeatureInfo</span><span class="p">,</span> <span class="n">FeatureHint</span><span class="p">,</span> <span class="n">FeatureType</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">replay.utils.spark_utils</span> <span class="kn">import</span> <span class="n">convert2spark</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">data_frame</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;user_id&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="s2">&quot;item_id&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="s2">&quot;rating&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">]})</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">data_frame_for_predict</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;user_id&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="s2">&quot;item_id&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">]})</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">data_frame</span>
<span class="go">   user_id  item_id  rating</span>
<span class="go">0         1         1          2</span>
<span class="go">1         1         2          1</span>
<span class="go">2         2         2          4</span>
<span class="go">3         3         3          1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">interactions</span> <span class="o">=</span> <span class="n">convert2spark</span><span class="p">(</span><span class="n">data_frame</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">pred_interactions</span> <span class="o">=</span> <span class="n">convert2spark</span><span class="p">(</span><span class="n">data_frame_for_predict</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">feature_schema</span> <span class="o">=</span> <span class="n">FeatureSchema</span><span class="p">(</span>
<span class="gp">... </span>    <span class="p">[</span>
<span class="gp">... </span>        <span class="n">FeatureInfo</span><span class="p">(</span>
<span class="gp">... </span>            <span class="n">column</span><span class="o">=</span><span class="s2">&quot;user_id&quot;</span><span class="p">,</span>
<span class="gp">... </span>            <span class="n">feature_type</span><span class="o">=</span><span class="n">FeatureType</span><span class="o">.</span><span class="n">CATEGORICAL</span><span class="p">,</span>
<span class="gp">... </span>            <span class="n">feature_hint</span><span class="o">=</span><span class="n">FeatureHint</span><span class="o">.</span><span class="n">QUERY_ID</span><span class="p">,</span>
<span class="gp">... </span>        <span class="p">),</span>
<span class="gp">... </span>        <span class="n">FeatureInfo</span><span class="p">(</span>
<span class="gp">... </span>            <span class="n">column</span><span class="o">=</span><span class="s2">&quot;item_id&quot;</span><span class="p">,</span>
<span class="gp">... </span>            <span class="n">feature_type</span><span class="o">=</span><span class="n">FeatureType</span><span class="o">.</span><span class="n">CATEGORICAL</span><span class="p">,</span>
<span class="gp">... </span>            <span class="n">feature_hint</span><span class="o">=</span><span class="n">FeatureHint</span><span class="o">.</span><span class="n">ITEM_ID</span><span class="p">,</span>
<span class="gp">... </span>        <span class="p">),</span>
<span class="gp">... </span>        <span class="n">FeatureInfo</span><span class="p">(</span>
<span class="gp">... </span>            <span class="n">column</span><span class="o">=</span><span class="s2">&quot;rating&quot;</span><span class="p">,</span>
<span class="gp">... </span>            <span class="n">feature_type</span><span class="o">=</span><span class="n">FeatureType</span><span class="o">.</span><span class="n">NUMERICAL</span><span class="p">,</span>
<span class="gp">... </span>            <span class="n">feature_hint</span><span class="o">=</span><span class="n">FeatureHint</span><span class="o">.</span><span class="n">RATING</span><span class="p">,</span>
<span class="gp">... </span>        <span class="p">),</span>
<span class="gp">... </span>    <span class="p">]</span>
<span class="gp">... </span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">train_dataset</span> <span class="o">=</span> <span class="n">Dataset</span><span class="p">(</span><span class="n">feature_schema</span><span class="p">,</span> <span class="n">interactions</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">pred_dataset</span> <span class="o">=</span> <span class="n">Dataset</span><span class="p">(</span><span class="n">feature_schema</span><span class="o">.</span><span class="n">subset</span><span class="p">([</span><span class="s2">&quot;user_id&quot;</span><span class="p">,</span> <span class="s2">&quot;item_id&quot;</span><span class="p">]),</span> <span class="n">pred_interactions</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">model</span> <span class="o">=</span> <span class="n">AssociationRulesItemRec</span><span class="p">(</span><span class="n">min_item_count</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">min_pair_count</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">session_column</span><span class="o">=</span><span class="s2">&quot;user_id&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">res</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">train_dataset</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">model</span><span class="o">.</span><span class="n">similarity</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="go">+------------+------------+----------+----+---------------+</span>
<span class="go">|item_idx_one|item_idx_two|confidence|lift|confidence_gain|</span>
<span class="go">+------------+------------+----------+----+---------------+</span>
<span class="go">|           1|           2|       1.0| 1.5|            2.0|</span>
<span class="go">|           2|           1|       0.5| 1.5|       Infinity|</span>
<span class="go">+------------+------------+----------+----+---------------+</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">model</span><span class="o">.</span><span class="n">similarity_metric</span> <span class="o">=</span> <span class="s2">&quot;confidence&quot;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">model</span><span class="o">.</span><span class="n">predict_pairs</span><span class="p">(</span><span class="n">pred_interactions</span><span class="p">,</span> <span class="n">train_dataset</span><span class="p">)</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="go">+-------+-------+------+</span>
<span class="go">|user_id|item_id|rating|</span>
<span class="go">+-------+-------+------+</span>
<span class="go">|      2|      1|   0.5|</span>
<span class="go">+-------+-------+------+</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">model</span><span class="o">.</span><span class="n">similarity_metric</span> <span class="o">=</span> <span class="s2">&quot;lift&quot;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">model</span><span class="o">.</span><span class="n">predict_pairs</span><span class="p">(</span><span class="n">pred_interactions</span><span class="p">,</span> <span class="n">train_dataset</span><span class="p">)</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="go">+-------+-------+------+</span>
<span class="go">|user_id|item_id|rating|</span>
<span class="go">+-------+-------+------+</span>
<span class="go">|      2|      1|   1.5|</span>
<span class="go">+-------+-------+------+</span>
</pre></div>
</div>
<p>Classical model uses items co-occurrence in sessions for
confidence, lift and confidence_gain calculation
but rating could also be passed to the model, e.g.
if you want to apply time smoothing and treat old sessions as less important.
In this case all items in sessions should have the same rating.</p>
<dl class="py method">
<dt class="sig sig-object py" id="replay.models.AssociationRulesItemRec.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">session_column</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">min_item_count</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">5</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">min_pair_count</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">5</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">num_neighbours</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1000</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">use_rating</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">similarity_metric</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'confidence'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">index_builder</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#replay.models.AssociationRulesItemRec.__init__" title="Permalink to this definition"></a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>session_column</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>) – name of column to group sessions.
Items are combined by the <code class="docutils literal notranslate"><span class="pre">user_id</span></code> column if <code class="docutils literal notranslate"><span class="pre">session_column</span></code> is not defined.</p></li>
<li><p><strong>min_item_count</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code>) – items with fewer sessions will be filtered out</p></li>
<li><p><strong>min_pair_count</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code>) – pairs with fewer sessions will be filtered out</p></li>
<li><p><strong>num_neighbours</strong> (<code class="xref py py-data docutils literal notranslate"><span class="pre">Optional</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code>]) – maximal number of neighbours to save for each item</p></li>
<li><p><strong>use_rating</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">bool</span></code>) – flag to use rating values instead of co-occurrence count
If true, pair rating in session is minimal rating of item in pair.
Item rating is sum of rating in all sessions.</p></li>
<li><p><strong>similarity_metric</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>) – <cite>lift</cite> of ‘confidence’
The metric used as a similarity to calculate the prediction,
one of [<code class="docutils literal notranslate"><span class="pre">lift</span></code>, <code class="docutils literal notranslate"><span class="pre">confidence</span></code>, <code class="docutils literal notranslate"><span class="pre">confidence_gain</span></code>]</p></li>
<li><p><strong>index_builder</strong> (<code class="xref py py-data docutils literal notranslate"><span class="pre">Optional</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">IndexBuilder</span></code>]) – <cite>IndexBuilder</cite> instance that adds ANN functionality.
If not set, then ann will not be used.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="replay.models.AssociationRulesItemRec.get_nearest_items">
<span class="sig-name descname"><span class="pre">get_nearest_items</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">items</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">k</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">metric</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'lift'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">candidates</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#replay.models.AssociationRulesItemRec.get_nearest_items" title="Permalink to this definition"></a></dt>
<dd><p>Get k most similar items be the <cite>metric</cite> for each of the <cite>items</cite>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>items</strong> (<code class="xref py py-data docutils literal notranslate"><span class="pre">Union</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">DataFrame</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">Iterable</span></code>]) – spark dataframe or list of item ids to find neighbors</p></li>
<li><p><strong>k</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code>) – number of neighbors</p></li>
<li><p><strong>metric</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>) – <cite>lift</cite> of ‘confidence_gain’</p></li>
<li><p><strong>candidates</strong> (<code class="xref py py-data docutils literal notranslate"><span class="pre">Union</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">DataFrame</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">Iterable</span></code>, <code class="xref py py-obj docutils literal notranslate"><span class="pre">None</span></code>]) – spark dataframe or list of items
to consider as similar, e.g. popular/new items. If None,
all items presented during model training are used.</p></li>
</ul>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p><code class="xref py py-class docutils literal notranslate"><span class="pre">DataFrame</span></code></p>
</dd>
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>dataframe with the most similar items an distance,
where bigger value means greater similarity.
spark-dataframe with columns <code class="docutils literal notranslate"><span class="pre">[item_id,</span> <span class="pre">neighbour_item_id,</span> <span class="pre">similarity]</span></code></p>
</dd>
</dl>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="cluster-recommender">
<h3>Cluster Recommender<a class="headerlink" href="#cluster-recommender" title="Permalink to this heading"></a></h3>
<dl class="py class">
<dt class="sig sig-object py" id="replay.models.ClusterRec">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">replay.models.</span></span><span class="sig-name descname"><span class="pre">ClusterRec</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">num_clusters</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">10</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#replay.models.ClusterRec" title="Permalink to this definition"></a></dt>
<dd><p>Generate recommendations for cold queries using k-means clusters</p>
<dl class="py method">
<dt class="sig sig-object py" id="replay.models.ClusterRec.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">num_clusters</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">10</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#replay.models.ClusterRec.__init__" title="Permalink to this definition"></a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>num_clusters</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code>) – number of clusters</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

</div>
</div>
<div class="section" id="neural-models-with-distributed-inference">
<h2>Neural models with distributed inference<a class="headerlink" href="#neural-models-with-distributed-inference" title="Permalink to this heading"></a></h2>
<p>Models implemented in pytorch with distributed inference in pyspark.</p>
<div class="section" id="neural-matrix-factorization-experimental">
<h3>Neural Matrix Factorization (Experimental)<a class="headerlink" href="#neural-matrix-factorization-experimental" title="Permalink to this heading"></a></h3>
<dl class="py class">
<dt class="sig sig-object py" id="replay.experimental.models.NeuroMF">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">replay.experimental.models.</span></span><span class="sig-name descname"><span class="pre">NeuroMF</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">learning_rate</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.05</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">epochs</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">20</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">embedding_gmf_dim</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">embedding_mlp_dim</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">hidden_mlp_dims</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">l2_reg</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">count_negative_sample</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">factor</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.2</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">patience</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">3</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#replay.experimental.models.NeuroMF" title="Permalink to this definition"></a></dt>
<dd><p>Neural Matrix Factorization model (NeuMF, NCF).</p>
<p>In this implementation MLP and GMF modules are optional.</p>
<dl class="py method">
<dt class="sig sig-object py" id="replay.experimental.models.NeuroMF.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">learning_rate</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.05</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">epochs</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">20</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">embedding_gmf_dim</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">embedding_mlp_dim</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">hidden_mlp_dims</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">l2_reg</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">count_negative_sample</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">factor</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.2</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">patience</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">3</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#replay.experimental.models.NeuroMF.__init__" title="Permalink to this definition"></a></dt>
<dd><p>MLP or GMF model can be ignored if
its embedding size (embedding_mlp_dim or embedding_gmf_dim) is set to <code class="docutils literal notranslate"><span class="pre">None</span></code>.
Default variant is MLP + GMF with embedding size 128.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>learning_rate</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code>) – learning rate</p></li>
<li><p><strong>epochs</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code>) – number of epochs to train model</p></li>
<li><p><strong>embedding_gmf_dim</strong> (<code class="xref py py-data docutils literal notranslate"><span class="pre">Optional</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code>]) – embedding size for gmf</p></li>
<li><p><strong>embedding_mlp_dim</strong> (<code class="xref py py-data docutils literal notranslate"><span class="pre">Optional</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code>]) – embedding size for mlp</p></li>
<li><p><strong>hidden_mlp_dims</strong> (<code class="xref py py-data docutils literal notranslate"><span class="pre">Optional</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">List</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code>]]) – list of hidden dimension sized for mlp</p></li>
<li><p><strong>l2_reg</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code>) – l2 regularization term</p></li>
<li><p><strong>count_negative_sample</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code>) – number of negative samples to use</p></li>
<li><p><strong>factor</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code>) – ReduceLROnPlateau reducing factor. new_lr = lr * factor</p></li>
<li><p><strong>patience</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code>) – number of non-improved epochs before reducing lr</p></li>
</ul>
</dd>
</dl>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="mult-vae-experimental">
<h3>Mult-VAE (Experimental)<a class="headerlink" href="#mult-vae-experimental" title="Permalink to this heading"></a></h3>
<p>Variation AutoEncoder</p>
<img alt="../../_images/vae-gaussian.png" src="../../_images/vae-gaussian.png" />
<p><strong>Problem formulation</strong></p>
<p>We have a sample of independent equally distributed random values from true distribution
<span class="math notranslate nohighlight">\(x_i \sim p_d(x)\)</span>, <span class="math notranslate nohighlight">\(i = 1, \dots, N\)</span>.</p>
<p>Build a probability model <span class="math notranslate nohighlight">\(p_\theta(x)\)</span> for true distribution <span class="math notranslate nohighlight">\(p_d(x)\)</span>.</p>
<p>Distribution <span class="math notranslate nohighlight">\(p_\theta(x)\)</span> allows both to estimate probability density for a given item <span class="math notranslate nohighlight">\(x\)</span>,
and to sample <span class="math notranslate nohighlight">\(x \sim p_\theta(x)\)</span>.</p>
<p><strong>Probability model</strong></p>
<p><span class="math notranslate nohighlight">\(z \in \mathbb{R}^d\)</span> - is a local latent variable, one for each item <span class="math notranslate nohighlight">\(x\)</span>.</p>
<p>Generative process for variational autoencoder:</p>
<ol class="arabic simple">
<li><p>Sample <span class="math notranslate nohighlight">\(z \sim p(z)\)</span>.</p></li>
<li><p>Sample <span class="math notranslate nohighlight">\(x \sim p_\theta(x | z)\)</span>.</p></li>
</ol>
<p>Distribution parameters <span class="math notranslate nohighlight">\(p_\theta(x | z)\)</span> are defined with neural net weights <span class="math notranslate nohighlight">\(\theta\)</span>, with input <span class="math notranslate nohighlight">\(z\)</span>.</p>
<p>Item probability density
<span class="math notranslate nohighlight">\(x\)</span>:</p>
<div class="math notranslate nohighlight">
\[p_\theta(x) = \mathbb{E}_{z \sim p(z)} p_\theta(x | z)\]</div>
<p>Use lower estimate bound for the log likelihood.</p>
<div class="math notranslate nohighlight">
\[\begin{split}\log p_\theta(x) = \mathbb{E}_{z \sim q_\phi(z | x)} \log p_\theta(
x) = \mathbb{E}_{z \sim q_\phi(z | x)} \log \frac{p_\theta(x,
z) q_\phi(z | x)} {q_\phi(z | x) p_\theta(z | x)} = \\
= \mathbb{E}_{z
\sim q_\phi(z | x)} \log \frac{p_\theta(x, z)}{q_\phi(z | x)} + KL(
q_\phi(z | x) || p_\theta(z | x))\end{split}\]</div>
<div class="math notranslate nohighlight">
\[\begin{split}\log p_\theta(x) \geqslant \mathbb{E}_{z \sim q_\phi(z | x)}
\log \frac{p_\theta(x | z)p(z)}{q_\phi(z | x)} =
\mathbb{E}_{z \sim q_\phi(z | x)} \log p_\theta(x | z) -
KL(q_\phi(z | x) || p(z)) = \\
= L(x; \phi, \theta) \to \max\limits_{\phi, \theta}\end{split}\]</div>
<p><span class="math notranslate nohighlight">\(q_\phi(z | x)\)</span> is a proposal or a recognition distribution. It is a gaussian with weights <span class="math notranslate nohighlight">\(\phi\)</span>:
<span class="math notranslate nohighlight">\(q_\phi(z | x) = \mathcal{N}(z | \mu_\phi(x), \sigma^2_\phi(x)I)\)</span>.</p>
<p>Difference between lower estimate bound <span class="math notranslate nohighlight">\(L(x; \phi, \theta)\)</span> and log likelihood
<span class="math notranslate nohighlight">\(\log p_\theta(x)\)</span> - is a KL-divergence between a proposal and aposteriory distribution on <span class="math notranslate nohighlight">\(z\)</span>:
<span class="math notranslate nohighlight">\(KL(q_\phi(z | x) || p_\theta(z | x))\)</span>. Maximum value
<span class="math notranslate nohighlight">\(L(x; \phi, \theta)\)</span> for fixed model parameters
<span class="math notranslate nohighlight">\(\theta\)</span>
is reached with <span class="math notranslate nohighlight">\(q_\phi(z | x) = p_\theta(z | x)\)</span>, but explicit calculation of
<span class="math notranslate nohighlight">\(p_\theta(z | x)\)</span> is not efficient to calculate,
so it is also optimized by <span class="math notranslate nohighlight">\(\phi\)</span>. The closer <span class="math notranslate nohighlight">\(q_\phi(z | x)\)</span> to
<span class="math notranslate nohighlight">\(p_\theta(z | x)\)</span>, the better the estimate.</p>
<p>We usually take normal distribution for <span class="math notranslate nohighlight">\(p(z)\)</span>:</p>
<div class="math notranslate nohighlight">
\[\varepsilon \sim \mathcal{N}(\varepsilon | 0, I)\]</div>
<div class="math notranslate nohighlight">
\[z = \mu + \sigma \varepsilon \Rightarrow z \sim \mathcal{N}(z | \mu,
\sigma^2I)\]</div>
<div class="math notranslate nohighlight">
\[\frac{\partial}{\partial \phi} L(x; \phi, \theta) = \mathbb{E}_{
\varepsilon \sim \mathcal{N}(\varepsilon | 0, I)} \frac{\partial}
{\partial \phi} \log p_\theta(x | \mu_\phi(x) + \sigma_\phi(x)
\varepsilon) - \frac{\partial}{\partial \phi} KL(q_\phi(z | x) ||
p(z))\]</div>
<div class="math notranslate nohighlight">
\[\frac{\partial}{\partial \theta} L(x; \phi, \theta) = \mathbb{E}_{z
\sim q_\phi(z | x)} \frac{\partial}{\partial \theta} \log
p_\theta(x | z)\]</div>
<p>In this case</p>
<div class="math notranslate nohighlight">
\[KL(q_\phi(z | x) || p(z)) = -\frac{1}{2}\sum_{i=1}^{dimZ}(1+
log(\sigma_i^2) - \mu_i^2-\sigma_i^2)\]</div>
<p>KL-divergence coefficient can also not be equal to one, in this case:</p>
<div class="math notranslate nohighlight">
\[L(x; \phi, \theta) =
\mathbb{E}_{z \sim q_\phi(z | x)} \log p_\theta(x | z) -
\beta \cdot KL(q_\phi(z | x) || p(z)) \to \max\limits_{\phi, \theta}\]</div>
<p>With <span class="math notranslate nohighlight">\(\beta = 0\)</span> VAE is the same as the
Denoising AutoEncoder.</p>
<dl class="py class">
<dt class="sig sig-object py" id="replay.experimental.models.MultVAE">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">replay.experimental.models.</span></span><span class="sig-name descname"><span class="pre">MultVAE</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">learning_rate</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.01</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">epochs</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">100</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">latent_dim</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">200</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">hidden_dim</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">600</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dropout</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.3</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">anneal</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">l2_reg</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">factor</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.2</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">patience</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">3</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#replay.experimental.models.MultVAE" title="Permalink to this definition"></a></dt>
<dd><p><a class="reference external" href="https://arxiv.org/pdf/1802.05814.pdf">Variational Autoencoders for Collaborative Filtering</a></p>
<dl class="py method">
<dt class="sig sig-object py" id="replay.experimental.models.MultVAE.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">learning_rate</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.01</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">epochs</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">100</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">latent_dim</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">200</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">hidden_dim</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">600</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dropout</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.3</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">anneal</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">l2_reg</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">factor</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.2</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">patience</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">3</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#replay.experimental.models.MultVAE.__init__" title="Permalink to this definition"></a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>learning_rate</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code>) – learning rate</p></li>
<li><p><strong>epochs</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code>) – number of epochs to train model</p></li>
<li><p><strong>latent_dim</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code>) – latent dimension size for user vectors</p></li>
<li><p><strong>hidden_dim</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code>) – hidden dimension size for encoder and decoder</p></li>
<li><p><strong>dropout</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code>) – dropout coefficient</p></li>
<li><p><strong>anneal</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code>) – anneal coefficient [0,1]</p></li>
<li><p><strong>l2_reg</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code>) – l2 regularization term</p></li>
<li><p><strong>factor</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code>) – ReduceLROnPlateau reducing factor. new_lr = lr * factor</p></li>
<li><p><strong>patience</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code>) – number of non-improved epochs before reducing lr</p></li>
</ul>
</dd>
</dl>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="ddpg-experimental">
<h3>DDPG (Experimental)<a class="headerlink" href="#ddpg-experimental" title="Permalink to this heading"></a></h3>
<dl class="py class">
<dt class="sig sig-object py" id="replay.experimental.models.DDPG">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">replay.experimental.models.</span></span><span class="sig-name descname"><span class="pre">DDPG</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">noise_sigma</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.2</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">noise_theta</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.05</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">noise_type</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'gauss'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">seed</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">9</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">user_num</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">10</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">item_num</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">10</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">log_dir</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'logs/tmp'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">exact_embeddings_size</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n_critics_head</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">10</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">env_gamma_alpha</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.2</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">critic_heads_q</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.15</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n_jobs</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">use_gpu</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">user_batch_size</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">8</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">min_trajectory_len</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">10</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#replay.experimental.models.DDPG" title="Permalink to this definition"></a></dt>
<dd><p><a class="reference external" href="https://arxiv.org/pdf/1810.12027.pdf">Deep Deterministic Policy Gradient</a></p>
<p>This implementation enhanced by more advanced noise strategy.</p>
<dl class="py method">
<dt class="sig sig-object py" id="replay.experimental.models.DDPG.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">noise_sigma</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.2</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">noise_theta</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.05</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">noise_type</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'gauss'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">seed</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">9</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">user_num</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">10</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">item_num</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">10</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">log_dir</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'logs/tmp'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">exact_embeddings_size</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n_critics_head</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">10</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">env_gamma_alpha</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.2</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">critic_heads_q</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.15</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n_jobs</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">use_gpu</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">user_batch_size</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">8</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">min_trajectory_len</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">10</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#replay.experimental.models.DDPG.__init__" title="Permalink to this definition"></a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>noise_sigma</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code>) – Ornstein-Uhlenbeck noise sigma value</p></li>
<li><p><strong>noise_theta</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code>) – Ornstein-Uhlenbeck noise theta value</p></li>
<li><p><strong>noise_type</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>) – type of action noise, one of [“ou”, “gauss”]</p></li>
<li><p><strong>seed</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code>) – random seed</p></li>
<li><p><strong>user_num</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code>) – number of users, specify when using <code class="docutils literal notranslate"><span class="pre">exact_embeddings_size</span></code></p></li>
<li><p><strong>item_num</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code>) – number of items, specify when using <code class="docutils literal notranslate"><span class="pre">exact_embeddings_size</span></code></p></li>
<li><p><strong>log_dir</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>) – dir to save models</p></li>
</ul>
</dd>
<dt class="field-even">Exact_embeddings_size</dt>
<dd class="field-even"><p>flag whether to set user/item_num from training log</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="cql-recommender-experimental">
<h3>CQL Recommender (Experimental)<a class="headerlink" href="#cql-recommender-experimental" title="Permalink to this heading"></a></h3>
<p>Conservative Q-Learning (CQL) algorithm is a SAC-based data-driven deep reinforcement learning algorithm,
which achieves state-of-the-art performance in offline RL problems.</p>
<p>* incompatible with python 3.10</p>
<img alt="../../_images/cql_comparison.png" src="../../_images/cql_comparison.png" />
<dl class="py class">
<dt class="sig sig-object py" id="replay.experimental.models.cql.CQL">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">replay.experimental.models.cql.</span></span><span class="sig-name descname"><span class="pre">CQL</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">mdp_dataset_builder</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n_epochs</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">actor_learning_rate</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.0001</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">critic_learning_rate</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.0003</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">temp_learning_rate</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.0001</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">alpha_learning_rate</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.0001</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">actor_optim_factory</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">d3rlpy.models.optimizers.AdamFactory(optim_cls='Adam',</span> <span class="pre">betas=(0.9,</span> <span class="pre">0.999),</span> <span class="pre">eps=1e-08,</span> <span class="pre">weight_decay=0,</span> <span class="pre">amsgrad=False)</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">critic_optim_factory</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">d3rlpy.models.optimizers.AdamFactory(optim_cls='Adam',</span> <span class="pre">betas=(0.9,</span> <span class="pre">0.999),</span> <span class="pre">eps=1e-08,</span> <span class="pre">weight_decay=0,</span> <span class="pre">amsgrad=False)</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">temp_optim_factory</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">d3rlpy.models.optimizers.AdamFactory(optim_cls='Adam',</span> <span class="pre">betas=(0.9,</span> <span class="pre">0.999),</span> <span class="pre">eps=1e-08,</span> <span class="pre">weight_decay=0,</span> <span class="pre">amsgrad=False)</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">alpha_optim_factory</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">d3rlpy.models.optimizers.AdamFactory(optim_cls='Adam',</span> <span class="pre">betas=(0.9,</span> <span class="pre">0.999),</span> <span class="pre">eps=1e-08,</span> <span class="pre">weight_decay=0,</span> <span class="pre">amsgrad=False)</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">actor_encoder_factory</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'default'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">critic_encoder_factory</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'default'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">q_func_factory</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'mean'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">batch_size</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">64</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n_frames</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n_steps</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">gamma</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.99</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tau</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.005</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n_critics</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">2</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">initial_temperature</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">initial_alpha</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">alpha_threshold</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">10.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">conservative_weight</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">5.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n_action_samples</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">10</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">soft_q_backup</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">use_gpu</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">scaler</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">action_scaler</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">reward_scaler</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">params</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#replay.experimental.models.cql.CQL" title="Permalink to this definition"></a></dt>
<dd><p>Conservative Q-Learning algorithm.</p>
<p>CQL is a SAC-based data-driven deep reinforcement learning algorithm, which
achieves state-of-the-art performance in offline RL problems.</p>
<p>CQL mitigates overestimation error by minimizing action-values under the
current policy and maximizing values under data distribution for
underestimation issue.</p>
<div class="math notranslate nohighlight">
\[L(\theta_i) = \alpha\, \mathbb{E}_{s_t \sim D}
\left[\log{\sum_a \exp{Q_{\theta_i}(s_t, a)}} - \mathbb{E}_{a \sim D} \big[Q_{\theta_i}(s_t, a)\big] - \tau\right]
+ L_\mathrm{SAC}(\theta_i)\]</div>
<p>where <span class="math notranslate nohighlight">\(lpha\)</span> is an automatically adjustable value via Lagrangian
dual gradient descent and :math:`   au` is a threshold value.
If the action-value difference is smaller than :math:`      au`, the
<span class="math notranslate nohighlight">\(lpha\)</span> will become smaller.
Otherwise, the <span class="math notranslate nohighlight">\(lpha\)</span> will become larger to aggressively penalize
action-values.</p>
<p>In continuous control, <span class="math notranslate nohighlight">\(\log{\sum_a \exp{Q(s, a)}}\)</span> is computed as
follows.</p>
<div class="math notranslate nohighlight">
\[\log{\sum_a \exp{Q(s, a)}} \approx \log{\left(
\frac{1}{2N} \sum_{a_i \sim \text{Unif}(a)}^N
    \left[\frac{\exp{Q(s, a_i)}}{\text{Unif}(a)}\right]
+ \frac{1}{2N} \sum_{a_i \sim \pi_\phi(a|s)}^N
    \left[\frac{\exp{Q(s, a_i)}}{\pi_\phi(a_i|s)}\right]\right)}\]</div>
<p>where <span class="math notranslate nohighlight">\(N\)</span> is the number of sampled actions.</p>
<p>An implementation of this algorithm is heavily based on the corresponding implementation
in the d3rlpy library (see <a class="reference external" href="https://github.com/takuseno/d3rlpy/blob/master/d3rlpy/algos/cql.py">https://github.com/takuseno/d3rlpy/blob/master/d3rlpy/algos/cql.py</a>)</p>
<p>The rest of optimization is exactly same as <code class="xref py py-class docutils literal notranslate"><span class="pre">d3rlpy.algos.SAC</span></code>.</p>
<dl class="simple">
<dt>References:</dt><dd><ul class="simple">
<li><p><a class="reference external" href="https://arxiv.org/abs/2006.04779">Kumar et al., Conservative Q-Learning for Offline Reinforcement
Learning.</a></p></li>
</ul>
</dd>
<dt>Args:</dt><dd><p>n_epochs (int): the number of epochs to learn.
mdp_dataset_builder (MdpDatasetBuilder): the MDP dataset builder from users’ log.
actor_learning_rate (float): learning rate for policy function.
critic_learning_rate (float): learning rate for Q functions.
temp_learning_rate (float): learning rate for temperature parameter of SAC.
alpha_learning_rate (float): learning rate for <span class="math notranslate nohighlight">\(lpha\)</span>.
actor_optim_factory (d3rlpy.models.optimizers.OptimizerFactory):
optimizer factory for the actor.
The available options are <cite>[SGD, Adam or RMSprop]</cite>.
critic_optim_factory (d3rlpy.models.optimizers.OptimizerFactory):
optimizer factory for the critic.
The available options are <cite>[SGD, Adam or RMSprop]</cite>.
temp_optim_factory (d3rlpy.models.optimizers.OptimizerFactory):
optimizer factory for the temperature.
The available options are <cite>[SGD, Adam or RMSprop]</cite>.
alpha_optim_factory (d3rlpy.models.optimizers.OptimizerFactory):
optimizer factory for <span class="math notranslate nohighlight">\(lpha\)</span>.
The available options are <cite>[SGD, Adam or RMSprop]</cite>.
actor_encoder_factory (d3rlpy.models.encoders.EncoderFactory or str):
encoder factory for the actor.
The available options are <cite>[‘pixel’, ‘dense’, ‘vector’, ‘default’]</cite>.
See d3rlpy.models.encoders.EncoderFactory for details.
critic_encoder_factory (d3rlpy.models.encoders.EncoderFactory or str):
encoder factory for the critic.
The available options are <cite>[‘pixel’, ‘dense’, ‘vector’, ‘default’]</cite>.
See d3rlpy.models.encoders.EncoderFactory for details.
q_func_factory (d3rlpy.models.q_functions.QFunctionFactory or str):
Q function factory. The available options are <cite>[‘mean’, ‘qr’, ‘iqn’, ‘fqf’]</cite>.
See d3rlpy.models.q_functions.QFunctionFactory for details.
batch_size (int): mini-batch size.
n_frames (int): the number of frames to stack for image observation.
n_steps (int): N-step TD calculation.
gamma (float): discount factor.
tau (float): target network synchronization coefficient.
n_critics (int): the number of Q functions for ensemble.
initial_temperature (float): initial temperature value.
initial_alpha (float): initial <span class="math notranslate nohighlight">\(lpha\)</span> value.
alpha_threshold (float): threshold value described as :math:`   au`.
conservative_weight (float): constant weight to scale conservative loss.
n_action_samples (int): the number of sampled actions to compute
<span class="math notranslate nohighlight">\(\log{\sum_a \exp{Q(s, a)}}\)</span>.
soft_q_backup (bool): flag to use SAC-style backup.
use_gpu (bool, int or d3rlpy.gpu.Device):
flag to use GPU, device ID or device.
scaler (d3rlpy.preprocessing.Scaler or str): preprocessor.
The available options are <cite>[‘pixel’, ‘min_max’, ‘standard’]</cite>.
action_scaler (d3rlpy.preprocessing.ActionScaler or str):
action preprocessor. The available options are <cite>[‘min_max’]</cite>.
reward_scaler (d3rlpy.preprocessing.RewardScaler or str):
reward preprocessor. The available options are
<cite>[‘clip’, ‘min_max’, ‘standard’]</cite>.
impl (d3rlpy.algos.torch.cql_impl.CQLImpl): algorithm implementation.</p>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="replay.experimental.models.cql.CQL.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">mdp_dataset_builder</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n_epochs</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">actor_learning_rate</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.0001</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">critic_learning_rate</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.0003</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">temp_learning_rate</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.0001</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">alpha_learning_rate</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.0001</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">actor_optim_factory</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">d3rlpy.models.optimizers.AdamFactory(optim_cls='Adam',</span> <span class="pre">betas=(0.9,</span> <span class="pre">0.999),</span> <span class="pre">eps=1e-08,</span> <span class="pre">weight_decay=0,</span> <span class="pre">amsgrad=False)</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">critic_optim_factory</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">d3rlpy.models.optimizers.AdamFactory(optim_cls='Adam',</span> <span class="pre">betas=(0.9,</span> <span class="pre">0.999),</span> <span class="pre">eps=1e-08,</span> <span class="pre">weight_decay=0,</span> <span class="pre">amsgrad=False)</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">temp_optim_factory</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">d3rlpy.models.optimizers.AdamFactory(optim_cls='Adam',</span> <span class="pre">betas=(0.9,</span> <span class="pre">0.999),</span> <span class="pre">eps=1e-08,</span> <span class="pre">weight_decay=0,</span> <span class="pre">amsgrad=False)</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">alpha_optim_factory</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">d3rlpy.models.optimizers.AdamFactory(optim_cls='Adam',</span> <span class="pre">betas=(0.9,</span> <span class="pre">0.999),</span> <span class="pre">eps=1e-08,</span> <span class="pre">weight_decay=0,</span> <span class="pre">amsgrad=False)</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">actor_encoder_factory</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'default'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">critic_encoder_factory</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'default'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">q_func_factory</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'mean'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">batch_size</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">64</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n_frames</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n_steps</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">gamma</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.99</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tau</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.005</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n_critics</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">2</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">initial_temperature</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">initial_alpha</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">alpha_threshold</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">10.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">conservative_weight</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">5.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n_action_samples</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">10</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">soft_q_backup</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">use_gpu</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">scaler</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">action_scaler</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">reward_scaler</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">params</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#replay.experimental.models.cql.CQL.__init__" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

</dd></dl>

</div>
</div>
<div class="section" id="wrappers-and-other-models-with-distributed-inference">
<h2>Wrappers and other models with distributed inference<a class="headerlink" href="#wrappers-and-other-models-with-distributed-inference" title="Permalink to this heading"></a></h2>
<p>Wrappers for popular recommendation libraries and algorithms
implemented in python with distributed inference in pyspark.</p>
<div class="section" id="admm-slim-experimental">
<h3>ADMM SLIM (Experimental)<a class="headerlink" href="#admm-slim-experimental" title="Permalink to this heading"></a></h3>
<dl class="py class">
<dt class="sig sig-object py" id="replay.experimental.models.ADMMSLIM">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">replay.experimental.models.</span></span><span class="sig-name descname"><span class="pre">ADMMSLIM</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">lambda_1</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">5</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">lambda_2</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">5000</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">seed</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">index_builder</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#replay.experimental.models.ADMMSLIM" title="Permalink to this definition"></a></dt>
<dd><p><a class="reference external" href="http://www.cs.columbia.edu/~jebara/papers/wsdm20_ADMM.pdf">ADMM SLIM: Sparse Recommendations for Many Users</a></p>
<p>This is a modification for the basic SLIM model.
Recommendations are improved with Alternating Direction Method of Multipliers.</p>
<dl class="py method">
<dt class="sig sig-object py" id="replay.experimental.models.ADMMSLIM.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">lambda_1</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">5</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">lambda_2</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">5000</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">seed</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">index_builder</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#replay.experimental.models.ADMMSLIM.__init__" title="Permalink to this definition"></a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>lambda_1</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code>) – l1 regularization term</p></li>
<li><p><strong>lambda_2</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code>) – l2 regularization term</p></li>
<li><p><strong>seed</strong> (<code class="xref py py-data docutils literal notranslate"><span class="pre">Optional</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code>]) – random seed</p></li>
<li><p><strong>index_builder</strong> (<code class="xref py py-data docutils literal notranslate"><span class="pre">Optional</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">IndexBuilder</span></code>]) – <cite>IndexBuilder</cite> instance that adds ANN functionality.
If not set, then ann will not be used.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="lightfm-experimental">
<h3>LightFM (Experimental)<a class="headerlink" href="#lightfm-experimental" title="Permalink to this heading"></a></h3>
<dl class="py class">
<dt class="sig sig-object py" id="replay.experimental.models.LightFMWrap">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">replay.experimental.models.</span></span><span class="sig-name descname"><span class="pre">LightFMWrap</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">no_components</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">128</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">loss</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'warp'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">random_state</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#replay.experimental.models.LightFMWrap" title="Permalink to this definition"></a></dt>
<dd><p>Wrapper for LightFM.</p>
<dl class="py method">
<dt class="sig sig-object py" id="replay.experimental.models.LightFMWrap.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">no_components</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">128</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">loss</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'warp'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">random_state</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#replay.experimental.models.LightFMWrap.__init__" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

</dd></dl>

</div>
<div class="section" id="implicit-experimental">
<h3>implicit (Experimental)<a class="headerlink" href="#implicit-experimental" title="Permalink to this heading"></a></h3>
<dl class="py class">
<dt class="sig sig-object py" id="replay.experimental.models.ImplicitWrap">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">replay.experimental.models.</span></span><span class="sig-name descname"><span class="pre">ImplicitWrap</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">model</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#replay.experimental.models.ImplicitWrap" title="Permalink to this definition"></a></dt>
<dd><p>Wrapper for <a class="reference external" href="https://github.com/benfred/implicit">implicit</a></p>
<p>Example:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">implicit</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">model</span> <span class="o">=</span> <span class="n">implicit</span><span class="o">.</span><span class="n">als</span><span class="o">.</span><span class="n">AlternatingLeastSquares</span><span class="p">(</span><span class="n">factors</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">als</span> <span class="o">=</span> <span class="n">ImplicitWrap</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
</pre></div>
</div>
<p>This way you can use implicit models as any other in replay
with conversions made under the hood.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">replay.utils.spark_utils</span> <span class="kn">import</span> <span class="n">convert2spark</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;user_idx&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="s2">&quot;item_idx&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="s2">&quot;relevance&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]})</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">df</span> <span class="o">=</span> <span class="n">convert2spark</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">als</span><span class="o">.</span><span class="n">fit_predict</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">users</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">])[[</span><span class="s2">&quot;user_idx&quot;</span><span class="p">,</span> <span class="s2">&quot;item_idx&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">toPandas</span><span class="p">()</span>
<span class="go">   user_idx  item_idx</span>
<span class="go">0         1         3</span>
</pre></div>
</div>
<dl class="py method">
<dt class="sig sig-object py" id="replay.experimental.models.ImplicitWrap.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">model</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#replay.experimental.models.ImplicitWrap.__init__" title="Permalink to this definition"></a></dt>
<dd><p>Provide initialized <code class="docutils literal notranslate"><span class="pre">implicit</span></code> model.</p>
</dd></dl>

</dd></dl>

</div>
</div>
<div class="section" id="neural-networks-recommenders">
<h2>Neural Networks recommenders<a class="headerlink" href="#neural-networks-recommenders" title="Permalink to this heading"></a></h2>
<div class="section" id="bert4rec">
<h3>Bert4Rec<a class="headerlink" href="#bert4rec" title="Permalink to this heading"></a></h3>
<dl class="py class">
<dt class="sig sig-object py" id="replay.models.nn.Bert4Rec">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">replay.models.nn.</span></span><span class="sig-name descname"><span class="pre">Bert4Rec</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">tensor_schema</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">block_count</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">2</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">head_count</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">4</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">hidden_size</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">256</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">max_seq_len</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">100</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dropout_rate</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pass_per_transformer_block_count</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">enable_positional_embedding</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">enable_embedding_tying</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">loss_type</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'CE'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">loss_sample_count</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">negative_sampling_strategy</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'global_uniform'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">negatives_sharing</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">optimizer_factory</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">lr_scheduler_factory</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#replay.models.nn.Bert4Rec" title="Permalink to this definition"></a></dt>
<dd><p>Implements BERT training-validation loop</p>
<dl class="py method">
<dt class="sig sig-object py" id="replay.models.nn.Bert4Rec.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">tensor_schema</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">block_count</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">2</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">head_count</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">4</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">hidden_size</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">256</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">max_seq_len</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">100</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dropout_rate</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pass_per_transformer_block_count</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">enable_positional_embedding</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">enable_embedding_tying</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">loss_type</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'CE'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">loss_sample_count</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">negative_sampling_strategy</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'global_uniform'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">negatives_sharing</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">optimizer_factory</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">lr_scheduler_factory</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#replay.models.nn.Bert4Rec.__init__" title="Permalink to this definition"></a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>(</strong><strong>TensorSchema</strong><strong>)</strong> (<em>tensor_schema</em>) – Tensor schema of features.</p></li>
<li><p><strong>block_count</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code>) – Number of Transformer blocks.
Default: <code class="docutils literal notranslate"><span class="pre">2</span></code>.</p></li>
<li><p><strong>head_count</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code>) – Number of Attention heads.
Default: <code class="docutils literal notranslate"><span class="pre">4</span></code>.</p></li>
<li><p><strong>hidden_size</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code>) – Hidden size of transformer.
Default: <code class="docutils literal notranslate"><span class="pre">256</span></code>.</p></li>
<li><p><strong>max_seq_len</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code>) – Max length of sequence.
Default: <code class="docutils literal notranslate"><span class="pre">100</span></code>.</p></li>
<li><p><strong>(</strong><strong>float</strong><strong>)</strong> (<em>dropout_rate</em>) – Dropout rate.
Default: <code class="docutils literal notranslate"><span class="pre">0.1</span></code>.</p></li>
<li><p><strong>pass_per_transformer_block_count</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code>) – Number of times to pass data over each Transformer block.
Default: <code class="docutils literal notranslate"><span class="pre">1</span></code>.</p></li>
<li><p><strong>enable_positional_embedding</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">bool</span></code>) – Add positional embedding to the result.
Default: <code class="docutils literal notranslate"><span class="pre">True</span></code>.</p></li>
<li><p><strong>enable_embedding_tying</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">bool</span></code>) – Use embedding tying head.
If <cite>True</cite> - result scores are calculated by dot product of input and output embeddings,
if <cite>False</cite> - default linear layer is applied to calculate logits for each item.
Default: <code class="docutils literal notranslate"><span class="pre">False</span></code>.</p></li>
<li><p><strong>loss_type</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>) – Loss type. Possible values: <code class="docutils literal notranslate"><span class="pre">&quot;CE&quot;</span></code>, <code class="docutils literal notranslate"><span class="pre">&quot;BCE&quot;</span></code>.
Default: <code class="docutils literal notranslate"><span class="pre">CE</span></code>.</p></li>
<li><p><strong>(</strong><strong>Optional</strong><strong>[</strong><strong>int</strong><strong>]</strong><strong>)</strong> (<em>loss_sample_count</em>) – Sample count to calculate loss.
Default: <code class="docutils literal notranslate"><span class="pre">None</span></code>.</p></li>
<li><p><strong>negative_sampling_strategy</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>) – Negative sampling strategy to calculate loss on sampled negatives.
Is used when large count of items in dataset.
Possible values: <code class="docutils literal notranslate"><span class="pre">&quot;global_uniform&quot;</span></code>, <code class="docutils literal notranslate"><span class="pre">&quot;inbatch&quot;</span></code>
Default: <code class="docutils literal notranslate"><span class="pre">global_uniform</span></code>.</p></li>
<li><p><strong>negatives_sharing</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">bool</span></code>) – Apply negative sharing in calculating sampled logits.
Default: <code class="docutils literal notranslate"><span class="pre">False</span></code>.</p></li>
<li><p><strong>optimizer_factory</strong> (<code class="xref py py-data docutils literal notranslate"><span class="pre">Optional</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">OptimizerFactory</span></code>]) – Optimizer factory.
Default: <code class="docutils literal notranslate"><span class="pre">None</span></code>.</p></li>
<li><p><strong>lr_scheduler_factory</strong> (<code class="xref py py-data docutils literal notranslate"><span class="pre">Optional</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">LRSchedulerFactory</span></code>]) – Learning rate schedule factory.
Default: <code class="docutils literal notranslate"><span class="pre">None</span></code>.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="replay.models.nn.Bert4Rec.predict_step">
<span class="sig-name descname"><span class="pre">predict_step</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">batch</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">batch_idx</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dataloader_idx</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#replay.models.nn.Bert4Rec.predict_step" title="Permalink to this definition"></a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>(</strong><strong>Bert4RecPredictionBatch</strong><strong>)</strong> (<em>batch</em>) – Batch of prediction data.</p></li>
<li><p><strong>(</strong><strong>int</strong><strong>)</strong> (<em>dataloader_idx</em>) – Batch index.</p></li>
<li><p><strong>(</strong><strong>int</strong><strong>)</strong> – Dataloader index.</p></li>
</ul>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p><code class="xref py py-class docutils literal notranslate"><span class="pre">Tensor</span></code></p>
</dd>
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>Calculated scores on prediction batch.</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="sasrec">
<h3>SasRec<a class="headerlink" href="#sasrec" title="Permalink to this heading"></a></h3>
<dl class="py class">
<dt class="sig sig-object py" id="replay.models.nn.SasRec">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">replay.models.nn.</span></span><span class="sig-name descname"><span class="pre">SasRec</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">tensor_schema</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">block_count</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">2</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">head_count</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">hidden_size</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">50</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">max_seq_len</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">200</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dropout_rate</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.2</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ti_modification</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">time_span</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">256</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">loss_type</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'CE'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">loss_sample_count</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">negative_sampling_strategy</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'global_uniform'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">negatives_sharing</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">optimizer_factory</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">lr_scheduler_factory</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#replay.models.nn.SasRec" title="Permalink to this definition"></a></dt>
<dd><p>SASRec Lightning module</p>
<dl class="py method">
<dt class="sig sig-object py" id="replay.models.nn.SasRec.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">tensor_schema</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">block_count</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">2</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">head_count</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">hidden_size</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">50</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">max_seq_len</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">200</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dropout_rate</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.2</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ti_modification</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">time_span</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">256</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">loss_type</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'CE'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">loss_sample_count</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">negative_sampling_strategy</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'global_uniform'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">negatives_sharing</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">optimizer_factory</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">lr_scheduler_factory</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#replay.models.nn.SasRec.__init__" title="Permalink to this definition"></a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>tensor_schema</strong> (<a class="reference internal" href="data.html#replay.data.nn.TensorSchema" title="replay.data.nn.schema.TensorSchema"><code class="xref py py-class docutils literal notranslate"><span class="pre">TensorSchema</span></code></a>) – Tensor schema of features.</p></li>
<li><p><strong>block_count</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code>) – Number of Transformer blocks.
Default: <code class="docutils literal notranslate"><span class="pre">2</span></code>.</p></li>
<li><p><strong>head_count</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code>) – Number of Attention heads.
Default: <code class="docutils literal notranslate"><span class="pre">1</span></code>.</p></li>
<li><p><strong>hidden_size</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code>) – Hidden size of transformer.
Default: <code class="docutils literal notranslate"><span class="pre">50</span></code>.</p></li>
<li><p><strong>max_seq_len</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code>) – Max length of sequence.
Default: <code class="docutils literal notranslate"><span class="pre">200</span></code>.</p></li>
<li><p><strong>dropout_rate</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code>) – Dropout rate.
Default: <code class="docutils literal notranslate"><span class="pre">0.2</span></code>.</p></li>
<li><p><strong>ti_modification</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">bool</span></code>) – Enable time relation.
Default: <code class="docutils literal notranslate"><span class="pre">False</span></code>.</p></li>
<li><p><strong>time_span</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code>) – Time span value.
Default: <code class="docutils literal notranslate"><span class="pre">256</span></code>.</p></li>
<li><p><strong>loss_type</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>) – Loss type. Possible values: <code class="docutils literal notranslate"><span class="pre">&quot;CE&quot;</span></code>, <code class="docutils literal notranslate"><span class="pre">&quot;BCE&quot;</span></code>.
Default: <code class="docutils literal notranslate"><span class="pre">CE</span></code>.</p></li>
<li><p><strong>(</strong><strong>Optional</strong><strong>[</strong><strong>int</strong><strong>]</strong><strong>)</strong> (<em>loss_sample_count</em>) – Sample count to calculate loss.
Default: <code class="docutils literal notranslate"><span class="pre">None</span></code>.</p></li>
<li><p><strong>negative_sampling_strategy</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>) – Negative sampling strategy to calculate loss on sampled negatives.
Is used when large count of items in dataset.
Possible values: <code class="docutils literal notranslate"><span class="pre">&quot;global_uniform&quot;</span></code>, <code class="docutils literal notranslate"><span class="pre">&quot;inbatch&quot;</span></code>
Default: <code class="docutils literal notranslate"><span class="pre">global_uniform</span></code>.</p></li>
<li><p><strong>negatives_sharing</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">bool</span></code>) – Apply negative sharing in calculating sampled logits.
Default: <code class="docutils literal notranslate"><span class="pre">False</span></code>.</p></li>
<li><p><strong>optimizer_factory</strong> (<code class="xref py py-data docutils literal notranslate"><span class="pre">Optional</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">OptimizerFactory</span></code>]) – Optimizer factory.
Default: <code class="docutils literal notranslate"><span class="pre">None</span></code>.</p></li>
<li><p><strong>lr_scheduler_factory</strong> (<code class="xref py py-data docutils literal notranslate"><span class="pre">Optional</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">LRSchedulerFactory</span></code>]) – Learning rate schedule factory.
Default: <code class="docutils literal notranslate"><span class="pre">None</span></code>.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="replay.models.nn.SasRec.predict_step">
<span class="sig-name descname"><span class="pre">predict_step</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">batch</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">batch_idx</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dataloader_idx</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#replay.models.nn.SasRec.predict_step" title="Permalink to this definition"></a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>batch</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">SasRecPredictionBatch</span></code>) – Batch of prediction data.</p></li>
<li><p><strong>batch_idx</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code>) – Batch index.</p></li>
<li><p><strong>dataloader_idx</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code>) – Dataloader index.</p></li>
</ul>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p><code class="xref py py-class docutils literal notranslate"><span class="pre">Tensor</span></code></p>
</dd>
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>Calculated scores.</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

</div>
</div>
</div>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="splitters.html" class="btn btn-neutral float-left" title="Splitters" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="metrics.html" class="btn btn-neutral float-right" title="Metrics" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, Sberbank AI Laboratory.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>